

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <title>Ajouter un handle au layout sur Magento - Jacques Bodin-Hullin, développeur Magento</title>
    <meta name="description" content="Il est très utile d'avoir des handles personnalisés dans notre layout pour certaines pages.">
    <meta name="keywords" content="layout, magento, handle, events">
    <meta name="author" content="Jacques Bodin-Hullin">
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/js/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
    <link rel="alternate" type="application/rss+xml" title="Jacques Bodin-Hullin - Latest Posts" href="/atom.xml" >

    <script type="text/javascript" src="/js/jquery-1.10.2.min.js" ></script>
    <script type="text/javascript" src="/js/fancybox/jquery.fancybox.pack.js" ></script>
    <script type="text/javascript" src="/js/event.js" ></script>
    <script type="text/javascript" src="/js/functions.js" ></script>

    <style for="gists"></style>
</head>
<body class="">

<div id="mainWrap">

    <div id="topWrap">
        <div id="headerWrap">
            <p>
                Jacques Bodin-Hullin
                <span class="baseline">Développeur d'applications Web</span>
            </p>
            <a href="http://jacques.sh"></a>

            <div id="magento_certified">
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="L'Agence Monsieur Biz est certifiée Magento Solution Specialist" class="solution-specialist" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="L'Agence Monsieur Biz est certifiée Magento Developer Plus" class="developer-plus" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin, développeur certifié Magento Developer" class="developer" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin est développeur certifié Magento Front End Developer" class="frontend-developer" target="_blank"></a>
            </div>



        </div>

        <blockquote id="quoteWrap">
            
            <p>
                La perfection est atteinte non quand il ne reste rien à ajouter, mais quand il ne reste
                rien à enlever.
            </p>
            <div><cite>Antoine de Saint Exupéry</cite></div>
            
        </blockquote>

        <ul id="menu">
            
            <li><a href="/"><span></span>Accueil</a></li>
            
            <li><a href="https://github.com/jacquesbh" target="_blank"><span></span>Code</a></li>
            
            
    
        
    

    
        
            
            <li><a href="/a-propos.html"><span></span>A propos</a></li>
            
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <li><a href="/references.html"><span></span>Références</a></li>
            
        
    

    
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    




            <li class="search">
                <form action="/search.html" method="get" id="search_form">
                    <div>
                        <input type="text" name="q" placeholder="Votre recherche" />
                    </div>
                </form>
            </li>
        </ul>

        <div class="mbiz">
            <p>
                <a href="http://monsieurbiz.com" title="Découvrez l'agence Monsieur Biz, spécialiste Magento">
                    <img src="/img/monsieurbiz_bg.png" title="L'Agence Monsieur Biz" />
                    <span>Vous cherchez une agence spécialiste du e-commerce certifiée Magento Solution Specialist ? L'agence Monsieur Biz est faite pour vous !</span>
                </a>
            </p>
        </div>
    </div>

    <div id="globalWrap">


    

    <div id="contentWrap" class="post">

        <h1>Ajouter un handle au layout sur Magento</h1>

        <blockquote><p>Hey Jacques, c'est possible d'avoir un affichage différent suivant le type de produit ?</p></blockquote>

<p>Bah évidemment ! Et c'est même natif sur Magento !</p>

<blockquote><p>Et on peut faire la même chose sur notre système éditorial ? Pour que suivant le type de news l'affichage soit différent ?</p></blockquote>

<p>Oui on peut, mais là ça implique un peu de dev !</p>

<blockquote><p>Il te faut combien de temps ?</p></blockquote>

<p>Je ne sais pas, pour mettre en place la personnalisation il faut 30 petites minutes... Ensuite pour faire ton templating bah ça dépendra de l'intégration que tu vas me fournir !</p>

<hr />

<p>C'est typiquement le genre de discussion qu'on peut avoir avec un chef de projet qui a besoin d'aller vite et qui vient vous voir pour estimer le travail qu'il va devoir donner aux développeurs. Mais quand on donne au développeur, qui, soit dit en passant, n'a jamais touché aux <em>handles personnalisés</em> sur Magento, ce travail... Et bien il a du mal à voir comment faire, et surtout... comment le faire en 30 minutes !</p>

<p>Laissez-moi vous montrer ;)</p>

<!-- more start -->


<hr />

<p>Avant toute chose vous devez savoir <a href="http://jacques.sh/le-layout-sur-magento.html">comment fonctionne le layout sur Magento</a>. Sans ça vous risquez d'être un peu perdu dans la suite de cet article.</p>

<p>On sait que les handles par défaut qui sont chargés sur notre page <code>frontname/controller/action</code> sont les suivants :</p>

<ul>
<li><code>default</code> : handle principal par défaut</li>
<li><code>STORE_default</code> : handle du store (par défaut)</li>
<li><code>THEME_frontend_default_default</code> : handle du thème (par défaut)</li>
<li><code>frontname_controller_action</code> : handle de notre action</li>
</ul>


<p>On peut aussi avoir les handles <code>customer_logged_out</code> ou <code>customer_logged_in</code> qui permettent de changer l'affichage suivant si le visiteur est connecté ou non.</p>

<p>Maintenant qu'on a ces handles il faut songer à en ajouter... Mais comment ?</p>

<h2>La méthode <code>loadLayout()</code></h2>

<p>Quand on a l'occasion de créer nos propres actions il est vite nécessaire de charger le layout (et donc les handles cités plus haut). Et pour ça c'est la méthode <code>loadLayout()</code> dans notre contrôleur qui fait l'affaire.</p>

<p>Mais cette méthode, elle fait quoi exactement ??</p>

<p>La méthode <code>loadLayout()</code> décortiquée/complétée/nettoyée et commentée ci-dessous :</p>

<script type="text/javascript">gist(4401568, 'load_layout.php', '18-19,30-31,33-35,37-39,50-53');</script>


<p>Vous avez compris le fonctionnement ? Les points les plus importants sont surlignés.</p>

<p>Ok, next ;)</p>

<h2>Un évènement</h2>

<p>Vous avez sans doute remarqué qu'un évènement <code>controller_action_layout_load_before</code> est lancé pile poil avant la génération du XML du Layout qui sera utilisé sur la page... C'est pas par hasard hein ;)</p>

<p>Sauf que le nom de cet évènement, quand on y regarde de plus près, bah il est commun à toutes les pages ! Comment savoir alors si on est bien sur <code>frontname/controller/action</code> ?</p>

<p>Je vais vous donner une solution rapide à mettre en place mais qui ne fonctionnera que sur certains projets assez petits car si vous voulez souvent "taper" sur cet évènement il faudra trouver autre chose. Par chance je l'explique plus bas !</p>

<p>Nous devons dans tous les cas agir sur notre évènement, donc un peu de config, et une classe avec une méthode <code>layoutLoadBefore</code> (pas très original, mais assez parlant) et le tour est joué !</p>

<p>Dans cette méthode on va simplement vérifier que nous sommes bien en train d'afficher notre action et nous allons pouvoir y faire l'ajout de notre nouvel handle :</p>

<script type="text/javascript">gist(4401568, 'observer_handle.php', '12-18');</script>


<p>L'idée c'est surtout de ne pas utiliser une triple condition à la <code>if ($action == 'action' &amp;&amp; $controller == 'controller' &amp;&amp; $module == 'module')</code> car c'est bien trop lourd. On a la possibilité d'avoir un nom d'action précis, alors on fait un case !</p>

<p>Ensuite on ajoute notre handle personnalisé, en majuscules (eh oui !).</p>

<p>Rien ne nous empêche de récupérer un objet dans le registre pour y ajouter un peu de dynamisme (c'est l'idée en fait) : <em>exemple avec une "news"</em></p>

<script type="text/javascript">gist(4401568, 'observer_news.php', '15-18');</script>


<p>A vous de jouer !</p>

<h2>Vérifions</h2>

<p>Pour vérifier que notre handle est présent, rien de plus simple : on ouvre le fichier <code>index.php</code> et on ajoute à la fin du fichier ces quelques lignes.</p>

<script type="text/javascript">gist(4401568, 'index.php');</script>


<p>On actualise ! Et pof ! (tout en bas..)</p>

<h2>En mieux ?</h2>

<p>Si vous devez faire un event sur plein de modules car vous avez souvent besoin de faire de l'affichage personnalisé (c'est super pratique il faut l'avouer !) et bien je vous propose de faire plutôt ceci : lancer un évènement un peu plus personnalisé !</p>

<p>Vous vous souvenez, on a un évènement "global". Mais cet évènement nous donne le nom de l'action (via <code>$observer-&gt;getAction()-&gt;getFullActionName()</code>).</p>

<p>On peut donc lancer un évènement précis pour chaque page sur notre e-commerce :</p>

<script type="text/javascript">gist(4401568, 'observer_dispatch.php', '13-16');</script>


<p>De cette manière on peut utiliser l'évènement <code>controller_action_layout_load_before_frontname_controller_action</code> pour ajouter notre handle sans crainte !</p>

<h2>Et au final ?</h2>

<p>Au final... n'abusez pas des évènements ;)</p>

<!-- more end -->





        <hr />

        
        <h2 id="comments">Commentaires</h2>
        


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jacquesbh'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




        
    </div>

    <div id="sideWrap">

    <h2>Quelques infos</h2>
    <ul class="infos">
        <li>
            <span>Par</span>
            <strong>Jacques Bodin-Hullin</strong>
            
        </li>
        <li>
            <span>Publié le</span>
            <strong>29 December 2012</strong>
        </li>
        <li>
            <span>Les tags</span>
            <strong>
                
                <a href="/search.html#!tag=Magento">Magento</a>, 
                
                <a href="/search.html#!tag=Layout">Layout</a>, 
                
                <a href="/search.html#!tag=Handle">Handle</a>, 
                
                <a href="/search.html#!tag=Events">Events</a>
                
            </strong>
        </li>
        
        
        <li>
            <span>Gist associé</span>
            <strong><a href="https://gist.github.com/4401568">4401568</a></strong>
        </li>
        
    </ul>

    <div class="social">
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/ajouter-un-handle-personnalise-sur-une-page-sur-magento.html" data-text="Ajouter un handle au layout sur Magento" data-via="jacquesbh">Tweet</a>
    </div>

    
</div>


    </div>

    <div id="bottomWrap">
        <div id="contactWrap">
            <form action="#" method="post" id="contact_form">
                <h3>Contact</h3>
                <p>
                    <label for="contactNom">Votre nom</label>
                    <input type="text" name="contact_name" id="contact_name" class="text" tabindex="1" />
                </p>
                <p>
                    <label for="contactEmail">Votre email</label>
                    <input type="email" name="contact_email" id="contact_email" class="text" tabindex="2" />
                </p>
                <p>
                    <label for="contactMessage">Message</label>
                    <textarea name="contact_message" id="contact_message" rows="5" cols="30" tabindex="8"></textarea>
                </p>
                <p class="send">
                    <input type="hidden" name="redirect_to" value="http://jacques.sh/contact/thanks.html" />
                    <input type="submit" id="contactSend" value="Envoyer" tabindex="9" />
                </p>
                <div style="display: none;" class="url">http://getsimpleform.com/messages?form_api_token=4ba030c3b67553e1ccb25710aee63bd6</div>
            </form>
            <div class="qrcode">
                <h3>Mon QRcode</h3>
                <p>
                    <img src="/img/qrcode.png" alt="le QRcode" width="198" height="192" />
                </p>
            </div>
        </div>

        <div id="footerWrap">
            <div class="social">
                <a href="https://twitter.com/jacquesbh" class="twitter-follow-button" data-show-count="false">Follow @jacquesbh</a>
            </div>
            
            <a href="http://monsieurbiz.com" title="Découvrez Monsieur Biz, une agence spécialisée sur Magento, solution e-commerce">Agence Magento</a>
            | 

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <a href="/credits.html">Crédits</a>
        
    

    
        
    

    
        
    

    
        
            |
            <a href="/legals.html">Informations légales</a>
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    





            | <a href="/atom.xml">RSS</a>
            | <a href="#" id="toplink">Haut de page</a>
            <br />
            <span class="copy">&copy; Jacques Bodin-Hullin - 2014</span>
        </div>
    </div>

</div>




  <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-27192340-2', 'auto');
  ga('send', 'pageview');

</script>






<script type="text/javascript" src="/js/jquery/cookies.js"></script>
    <div id="popin" class="monsieurbiz-popin" style="display: none;">
        <img src="/img/monsieurbiz.png" alt="" height="250" style="height: 250px;" />
        <h2><span class="lines">Un projet, Une agence</span></h2>
        <div class="action">
            <p>
                Monsieur Biz, une agence spécialisée Magento pour votre projet.
            </p>
            <a href="http://monsieurbiz.com">
                <div class="button1">C'est par ici que ça se passe !</div>
            </a>
        </div>
    </div>

    <script type="text/javascript">
    if (typeof disable_popin === 'undefined' || !disable_popin) {
        (function ($) {
            $(document).ready(function () {
                var cookieId = 'monsieurbizPopinDisplayed';
                if ($.cookie(cookieId) == null) {
                    $.fancybox.open('#popin');
                    $.cookie(cookieId, 'true');
                }
            });
         })(jQuery);
    }
    </script>


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</body>
</html>

