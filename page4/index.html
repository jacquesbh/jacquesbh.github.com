

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <title>Des articles sur Magento et plein d'autres choses ! - Jacques Bodin-Hullin, développeur Magento</title>
    
    
    <meta name="author" content="Jacques Bodin-Hullin">
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/js/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
    <link rel="alternate" type="application/rss+xml" title="Jacques Bodin-Hullin - Latest Posts" href="/atom.xml" >

    <script type="text/javascript" src="/js/jquery-1.10.2.min.js" ></script>
    <script type="text/javascript" src="/js/fancybox/jquery.fancybox.pack.js" ></script>
    <script type="text/javascript" src="/js/event.js" ></script>
    <script type="text/javascript" src="/js/functions.js" ></script>

    <style for="gists"></style>
</head>
<body class="">

<div id="mainWrap">

    <div id="topWrap">
        <div id="headerWrap">
            <p>
                Jacques Bodin-Hullin
                <span class="baseline">Développeur d'applications Web</span>
            </p>
            <a href="http://jacques.sh"></a>

            <!--
            <div id="magento_certified">
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="L'Agence Monsieur Biz est certifiée Magento Solution Specialist" class="solution-specialist" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="L'Agence Monsieur Biz est certifiée Magento Developer Plus" class="developer-plus" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin, développeur certifié Magento Developer" class="developer" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin est développeur certifié Magento Front End Developer" class="frontend-developer" target="_blank"></a>
            </div>
            -->

            <div id="forumphp">
                <a href="http://forumphp.org" title="J'y serai ! Forum PHP 2014 - AFUP" class="forumphp" target="_blank">
                    <img src="/img/forumphp2014.png" alt="" />
                </a>
            </div>

        </div>

        <blockquote id="quoteWrap">
            
            <p>
                La perfection est atteinte non quand il ne reste rien à ajouter, mais quand il ne reste
                rien à enlever.
            </p>
            <div><cite>Antoine de Saint Exupéry</cite></div>
            
        </blockquote>

        <ul id="menu">
            
            <li><a href="/"><span></span>Accueil</a></li>
            
            <li><a href="https://github.com/jacquesbh" target="_blank"><span></span>Code</a></li>
            
            
    
        
    

    
        
            
            <li><a href="/a-propos.html"><span></span>A propos</a></li>
            
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <li><a href="/references.html"><span></span>Références</a></li>
            
        
    

    
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    




            <li class="search">
                <form action="/search.html" method="get" id="search_form">
                    <div>
                        <input type="text" name="q" placeholder="Votre recherche" />
                    </div>
                </form>
            </li>
        </ul>

        <div class="mbiz">
            <p>
                <a href="http://monsieurbiz.com" title="Découvrez l'agence Monsieur Biz, spécialiste Magento">
                    <img src="/img/monsieurbiz_bg.png" title="L'Agence Monsieur Biz" />
                    <span>Vous cherchez une agence spécialiste du e-commerce certifiée Magento Solution Specialist ? L'agence Monsieur Biz est faite pour vous !</span>
                </a>
            </p>
        </div>
    </div>

    <div id="globalWrap">



<div id="sideWrap">

<h2>A propos</h2>
<div>
    <img src="/img/visage_edito.png" alt="" width="277" height="88" />
    <p>Bienvenue sur mon blog !</p>
    <p>Je suis <a href="/a-propos.html">Jacques Bodin-Hullin, développeur PHP confirmé, certifié Magento</a>.</p>
    <p>Ce blog est dédié au développement, PHP essentiellement, Javascript un peu, et tout le reste, évidemment !</p>
    <p>N'hésitez pas à aller faire un tour <a href="https://github.com/jacquesbh">sur mon github</a> afin de suivre mes projets et à poster vos remarques sur les articles que vous trouvez ici, c'est toujours constructif !</p>
    <p>J'espère que vous trouverez ici l'information que vous cherchez.</p>
</div>

<div>
    <p>Je suis également le fondateur de <a href="http://monsieurbiz.com">Monsieur Biz, une agence spécialisée Magento</a>.</p>
</div>

<hr />




<h2>Tags</h2>

<p class="tags">

    <span style="font-size:14.4px"><a href="/search.html#!tag=Jekyll">Jekyll</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Markdown">Markdown</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=GitHub">GitHub</a></span>

    <span style="font-size:37.2px"><a href="/search.html#!tag=Magento">Magento</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Snippets">Snippets</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Vim">Vim</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Netbeans">Netbeans</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=jQuery">jQuery</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Javascript">Javascript</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=PHP">PHP</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=URL">URL</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=Bonnes pratiques">Bonnes pratiques</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Ajax">Ajax</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Homepage">Homepage</a></span>

    <span style="font-size:16.8px"><a href="/search.html#!tag=Layout">Layout</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=CMS">CMS</a></span>

    <span style="font-size:15.6px"><a href="/search.html#!tag=The Installer">The Installer</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Android">Android</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Proxy">Proxy</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=HTTP">HTTP</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Git">Git</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Workflow">Workflow</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=Cache">Cache</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Block">Block</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=Module">Module</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Cart">Cart</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Customer">Customer</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Handle">Handle</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Events">Events</a></span>

    <span style="font-size:15.6px"><a href="/search.html#!tag=Attributes">Attributes</a></span>

    <span style="font-size:15.6px"><a href="/search.html#!tag=Product">Product</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Product type">Product type</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=EAV">EAV</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Thème">Thème</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=MariaDB">MariaDB</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=MySQL">MySQL</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Images">Images</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Aides de vue">Aides de vue</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=OS X">OS X</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Astuces">Astuces</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=MageConf">MageConf</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Émulation">Émulation</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Meet Magento">Meet Magento</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Productivité">Productivité</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=SSL">SSL</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Sécurité">Sécurité</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=COMODO">COMODO</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=gandi">gandi</a></span>

</p>

<hr />



</div>


<div id="contentWrap">

    


    <hr />
    <h2><a href="/supprimer-le-merge-des-paniers.html">Supprimer le merge des paniers</a></h2>
    <div class="content post">
        <p>Sur presque tous les projets Magento sur lesquels j'ai eu l'occasion de travailler il est apparu nécessaire de désactiver le merge du panier du client avec celui du visiteur lors de la connexion.</p>

<p>Pour cela nous devons commencer par <strong>identifier l'évènement</strong> lancé par Magento qui puisse nous permettre de supprimer ce fameux « merge » car aucune option en admin nous permet de l'empêcher.</p>

<!-- 


<hr />

<h2>Identifier l'évènement</h2>

<p>Il suffit d'investiguer un peu :</p>

<p>Objet <code>Mage_Sales_Model_Quote</code>, qui est donc notre objet « panier » :</p>

<p>Ligne 1678 : <code>public function merge(Mage_Sales_Model_Quote $quote)</code>.</p>

<p>Pour vérifier que notre merge passe bien par là on y place un log : <code>Mage::log(__METHOD__ . ':' . __LINE__);</code>.</p>

<p>On se connecte, on ajoute un produit à notre panier, on se déconnecte, on ajoute un produit dans notre panier et on se connecte à nouveau : là on a un log qui apparaît.</p>

<p>Nous avons trouvé sans trop de difficultés l'endroit où est fait le merge.</p>

<p>On remarque dans la méthode le lancement d'un évènement intéressant :</p>

<div class="highlight"><pre><code class="php"><span class="x">Mage::dispatchEvent(</span>
<span class="x">    $this-&gt;_eventPrefix . &#39;_merge_before&#39;,</span>
<span class="x">    array(</span>
<span class="x">    $this-&gt;_eventObject=&gt;$this,</span>
<span class="x">        &#39;source&#39;=&gt;$quote</span>
<span class="x">    )</span>
<span class="x">);</span>
</code></pre></div>


<p>A partir de là on déduit que l'évènement est <code>sales_quote_merge_before</code> et que ces deux données sont :</p>

<ol>
<li>  Le panier <code>quote</code> : panier du client</li>
<li>  Le panier <code>source</code> : panier du visiteur</li>
</ol>


<h2>La construction du module</h2>

<ol>
<li>  Un modèle <code>Observer</code> qui <code>catch</code> notre évènement et qui vide le panier du client.</li>
<li>  Un helper <code>Data</code> qui nous permet de savoir si notre module est activé et si on peut vider le panier du client quand celui du visiteur est vide.</li>
<li>  Un fichier <code>system.xml</code> qui nous permet d'ajouter un peu de configuation (configuration utilisée dans le helper).</li>
</ol>


<h3>Le helper</h3>

<p>Le helper n'est utilisé que pour savoir deux choses :</p>

<ol>
<li>  Notre module est-il activé ? Ou plutôt, pouvons-nous supprimer le merge des paniers ? Via la méthode <code>isActive</code>.</li>
<li>  Pouvons-nous vider le panier du client si le panier du visiteur est vide ? Via la méthode <code>cleanIfEmpty</code>.</li>
</ol>


<script src="http://gist-it.appspot.com/github/jacquesbh/jbh_cartmerge/raw/master/app/code/community/Jbh/CartMerge/Helper/Data.php"></script>


<h3>Le modèle</h3>

<p>Le modèle <code>catch</code> notre évènement est vide le panier du client que si les conditions suivantes sont validées&nbsp;:</p>

<ol>
<li>  Notre module est actif.</li>
<li>  Le panier du visiteur a des produits OU on peut vider le panier du client si le panier du visiteur est vide.</li>
</ol>


<script src="http://gist-it.appspot.com/github/jacquesbh/jbh_cartmerge/raw/master/app/code/community/Jbh/CartMerge/Model/Observer.php"></script>


<h3>Le <code>system.xml</code></h3>

<p>Le <code>system.xml</code> permet d'ajouter un peu de configuration, tout simplement.</p>

<p>Nous ne nous prenons pas la tête avec les <code>ACL</code> car ils sont déjà gérés par Magento pour cette partie de la configuration.</p>

<script src="http://gist-it.appspot.com/github/jacquesbh/jbh_cartmerge/raw/master/app/code/community/Jbh/CartMerge/etc/system.xml"></script>


<h2>Conclusion</h2>

<p>Il est en réalité assez simple, à présent, via le module complet, ou en suivant les étapes de cet article, de supprimer le merge des paniers du visiteur et du client lors de la connexion de notre client.</p>

<p>Vous trouverez le <a href="https://github.com/jacquesbh/jbh_cartmerge">code complet du module sur github</a>.</p>

 -->



    </div>
    <div class="voirPlus">
        <div class="social">
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/supprimer-le-merge-des-paniers.html" data-text="Supprimer le merge des paniers" data-via="jacquesbh">Tweet</a>
        </div>
        
        <a href="/supprimer-le-merge-des-paniers.html#disqus_thread">Commentaires</a> -
        

        <a href="/supprimer-le-merge-des-paniers.html">Lire la suite du tutoriel</a>

    </div>

    <hr />
    <h2><a href="/un-push-pour-vos-produits-sur-magento.html">Un push pour vos produits</a></h2>
    <div class="content post">
        <p>Ne vous êtes-vous jamais retrouvé à créer un block dédié au fameux « push produit » sur votre projet ?</p>

<p>Vous savez, le block qui affiche le produit et qu'on a envie de mettre partout, sur la homepage, sur une mise en avant ou que sais-je !</p>

<p>Cet article va vous montrer la meilleure manière de gérer ce problème en prenant en compte, je l'espère, une bonne partie des contraintes.</p>

<!-- 


<hr />

<div style="text-align: center;">
    <img alt="Push produit Magento EE" src="/images/posts/block-push-produit/push_produit_ee.png" height="272" width="161" style="border: 1px dashed gray;" />
</div>


<p>Pour bien faire nous allons créer le module <code>Jbh_Catalog</code>.</p>

<h2>De quoi avons-nous besoin ?</h2>

<p>Pour commencer, comme je l'explique souvent, nous devons déterminer vers quoi nous allons, et ce que nous allons faire. Il s'agit d'une partie d'analyse importante avant de développer.</p>

<p>On liste.</p>

<p>Nous devons :</p>

<ul>
<li> Créer un block <code>Jbh_Catalog_Block_Product_Push</code> pour afficher notre produit. Nous devons prévoir que notre block puisse s'ajuster au type de produit via des templates spécifiques. On poussera un peu la chose et pour cela nous aurons besoin d'un peu de config. Nous ne gérerons pas le cache de notre block (par défaut sur Magento).</li>
<li> Créer un helper <code>Jbh_Catalog_Helper_Product</code> pour récupérer notre block. Via la méthode <code>getPush($product)</code>.</li>
<li> Créer un modèle <code>Jbh_Catalog_Model_Product_Push_Config</code> pour gérer notre configuration.</li>
</ul>


<p>Maintenant que nous savons ce que nous devons faire, faisons-le par étape.</p>

<h2>La configuration</h2>

<p>Pourquoi avons-nous besoin d'un peu de config ?</p>

<p>Comme tout projet e-commerce j'imagine que votre boutique comprend plusieurs types de produits.</p>

<p>Par défaut Magento en comprend 6 types de produits différents (+ le type <code>Gift Card</code> en EE).</p>

<p>L'idée c'est que bien souvent chaque type de produit a un push un peu différent. Bien souvent on affiche des infos pour un type, par pour l'autre.</p>

<p>Une première solution pour gérer ça est de conditionner simplement notre <code>phtml</code> avec de simples <code>if ($_product-&gt;getTypeId() == Mage_Catalog_Model_Product_Type_Configurable::TYPE_CODE)</code> par exemple.</p>

<p>La seconde consiste à gérer un template par type, avec un template par défaut. Si le template pour le type du produit est défini alors on l'utilise, sinon on prend celui par défaut.</p>

<p>Voici un exemple de configuration que nous pouvons mettre en place :</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;jbh&gt;</span>
    <span class="nt">&lt;catalog&gt;</span>
        <span class="nt">&lt;product&gt;</span>
            <span class="nt">&lt;push&gt;</span>
                <span class="nt">&lt;modes&gt;</span>
                    <span class="nt">&lt;default&gt;</span>
                        <span class="nt">&lt;templates&gt;</span>
                            <span class="nt">&lt;default&gt;</span>jbh/catalog/product/push/grid/default.phtml<span class="nt">&lt;/default&gt;</span>
                            <span class="nt">&lt;simple&gt;</span>jbh/catalog/product/push/grid/default.phtml<span class="nt">&lt;/simple&gt;</span>
                            <span class="nt">&lt;giftcard&gt;</span>jbh/catalog/product/push/grid/default.phtml<span class="nt">&lt;/giftcard&gt;</span>
                        <span class="nt">&lt;/templates&gt;</span>
                    <span class="nt">&lt;/default&gt;</span>
                    <span class="nt">&lt;list&gt;</span>
                        <span class="nt">&lt;templates&gt;</span>
                            <span class="nt">&lt;default&gt;</span>jbh/catalog/product/push/list/default.phtml<span class="nt">&lt;/default&gt;</span>
                            <span class="nt">&lt;simple&gt;</span>jbh/catalog/product/push/list/default.phtml<span class="nt">&lt;/simple&gt;</span>
                            <span class="nt">&lt;giftcard&gt;</span>jbh/catalog/product/push/list/default.phtml<span class="nt">&lt;/giftcard&gt;</span>
                        <span class="nt">&lt;/templates&gt;</span>
                    <span class="nt">&lt;/list&gt;</span>
                <span class="nt">&lt;/modes&gt;</span>
            <span class="nt">&lt;/push&gt;</span>
        <span class="nt">&lt;/product&gt;</span>
    <span class="nt">&lt;/catalog&gt;</span>
<span class="nt">&lt;/jbh&gt;</span>
</code></pre></div>


<p>De cette manière il devient très facile de changer le template pour chaque mode ou chaque type de produit. Et pourquoi pas ajouter un <em>mode</em> ou encore un <em>type</em> fictif ? Après tout rien ne nous empêche d'inventer un mode, par exemple <code>homepage_mea</code>, pour changer les templates de tous les produits qui sont sur la mise en avant sur notre page d'accueil...</p>

<h3>Notre modèle</h3>

<p>Notre modèle <code>Jbh_Catalog_Model_Product_Push_Config</code> comprend les méthodes suivantes :</p>

<ul>
<li> <code>getModes()</code> qui retourne le tableau de tous les modes possibles.</li>
<li> <code>getTemplates($mode)</code> qui retourne un tableau des templates par types, suivant le mode.</li>
</ul>


<p>Bien sûr les <code>path</code> de la configuration sont dans des constantes.</p>

<script src="http://gist-it.appspot.com/github/jacquesbh/jbh_catalog/raw/master/app/code/community/Jbh/Catalog/Model/Product/Push/Config.php"></script>


<h2>Le block</h2>

<p>Notre block dépend surtout du produit et du mode que nous voulons utiliser pour l'affichage.</p>

<p>Pour cela nous indiquons dans notre fichier PHP que notre classe comprend les méthodes implicites suivantes :</p>

<ul>
<li> <code>@method Jbh_Catalog_Block_Product_Push setProduct(Mage_Catalog_Model_Product $product)</code></li>
<li> <code>@method Mage_Catalog_Model_Product getProduct()</code></li>
<li> <code>@method Jbh_Catalog_Block_Product_Push setMode(string $mode)</code></li>
<li> <code>@method string getMode()</code></li>
</ul>


<p>Ces méthodes sont utilisées lors de l'affichage dans la méthode <code>_toHtml</code>.</p>

<p>Si un template a déjà été défini (si jamais il a été forcé par exemple) alors nous ne le changeons pas.</p>

<script src="http://gist-it.appspot.com/github/jacquesbh/jbh_catalog/raw/master/app/code/community/Jbh/Catalog/Block/Product/Push.php"></script>


<h2>Le helper</h2>

<p>Notre helper est la clé de ce module car c'est lui qui va nous retourner notre block pour le produit que nous lui donnons.</p>

<p>Nous développons donc deux méthodes :</p>

<ul>
<li> <code>getPush($product, $mode = null)</code> qui retournera le block instancié.</li>
<li> <code>getPushHtml($product, $mode = null)</code> qui retournera le HTML du block.</li>
</ul>


<p>La première méthode fera juste une petite vérification : Notre variable <code>$product</code> est-elle bien un objet du type <code>Mage_Catalog_Model_Product</code> ? Si ça n'est pas le cas alors on considère que c'est un identifiant entier, et on <code>load</code> le produit. Ensuite on retourne notre nouveau block avec le produit et le mode dans ses données (via le <code>Varien_Object</code> hérité).</p>

<script src="http://gist-it.appspot.com/github/jacquesbh/jbh_catalog/raw/master/app/code/community/Jbh/Catalog/Helper/Product.php"></script>


<h2>Comment ça marche ?</h2>

<p>Pour utiliser notre block rien de plus simple !</p>

<p>Appelons simplement la méthode <code>getPushHtml</code> de notre helper :</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">echo</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">helper</span><span class="p">(</span><span class="s1">&#39;jbh_catalog/product&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getPushHtml</span><span class="p">(</span><span class="nv">$product</span><span class="p">,</span> <span class="nv">$mode</span><span class="p">);</span>
</code></pre></div>


<p>Le <code>$mode</code> n'est pas obligatoire.</p>

<p>Le <code>$product</code> peut être un produit instancié ou un entier (identifiant du produit).</p>

<h2>Conclusion</h2>

<p>Il vous est maintenant très facile, via un peu de configuration, de changer les différents affichages de vos produits sans vous prendre la tête.</p>

<p>Rien ne vous empêche comme vous pouvez le voir de créer un mode didié à une page en particulier.</p>

<p>Vous pouvez <a href="https://github.com/jacquesbh/jbh_catalog">retrouver le module <code>Jbh_Catalog</code> sur Github</a>.</p>

 -->





    </div>
    <div class="voirPlus">
        <div class="social">
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/un-push-pour-vos-produits-sur-magento.html" data-text="Un push pour vos produits" data-via="jacquesbh">Tweet</a>
        </div>
        
        <a href="/un-push-pour-vos-produits-sur-magento.html#disqus_thread">Commentaires</a> -
        

        <a href="/un-push-pour-vos-produits-sur-magento.html">Lire l'article</a>

    </div>

    <hr />
    <h2><a href="/le-layout-sur-magento.html">Le Layout sur Magento</a></h2>
    <div class="content post">
        <p>Le <em>Layout</em> est une partie vraiment importante que tout développeur Magento doit connaître.</p>

<p>De premier abord il n'est pas simple de comprendre le fonctionnement du layout et c'est bien là le but de cet article.</p>

<p>Mais pas seulement ! Je vais aussi vous donner quelques trucs pour maîtriser encore mieux le layout !</p>

<!-- 


<hr />

<p>Le <strong>Layout</strong> c'est du <em>XML</em>.</p>

<p>La balise principale est <code>layout</code>, quoi de mieux ?</p>

<h2>Les handles</h2>

<p>Le layout de Magento est vraiment très complet. On a des fichiers de plusieurs centaines de lignes parfois. Mais comment distinguer quelles parties du layout vont s'appliquer à notre page ?</p>

<p>Les <em>handles</em> sont des balises libres. Lors de son chargement Magento complète une liste de <em>handles</em> qui seront utilisés lors du rendu final.</p>

<p>Pour dire à notre action, dans notre contrôleur, d'utiliser les handles par défaut il faut utiliser la ligne de code suivante :</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Ci-dessous la ligne qui charge les handles par défaut du Layout</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadLayout</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>


<p>La méthode <code>loadLayout()</code> appelle deux méthodes qui sont les méthodes qui ajoutent réellement les handles par défaut :</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getLayout</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getUpdate</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addHandle</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">);</span>
</code></pre></div>


<p>et</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="nx">addActionLayoutHandles</span><span class="p">();</span>
</code></pre></div>


<p>Pour une action qui serait <code>jbh_foo/bar/baz</code> nous aurions les handles suivants :</p>

<ul>
<li> <code>default</code> : handle principal par défaut</li>
<li> <code>STORE_default</code> : handle du store (par défaut)</li>
<li> <code>THEME_frontend_default_default</code> : handle du thème (par défaut)</li>
<li> <code>jbh_foo_bar_baz</code> : handle de notre action</li>
</ul>


<p>On peut changer le handle <code>default</code> par autre chose si on le précise comme ceci :</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadLayout</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">);</span>
</code></pre></div>


<p>Avant le chargement de ces layouts l'évènement <code>controller_action_layout_load_before</code> est lancé par Magento. Donc si vous souhaitez ajouter un handle il faut le faire avant cet évènement.</p>

<p>Magento peut gérer des handles à l'infinie.</p>

<p>Attention cependant : L'ordre de traitement de ces handle a son importance ! Car on peut faire de la surcharge de <code>name</code> et bien d'autres choses encore !</p>

<p>Dans le layout, on peut demander à charger un handle défini de la manière suivante :</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;update</span> <span class="na">handle=</span><span class="s">&quot;nom_du_handle&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div>


<p>C'est très pratique ! Et ça permet surtout de ne pas dupliquer de code !</p>

<h3>Comment trouver le handle d'une page ?</h3>

<p>Prenons par exemple la page de connexion dont l'URL est : <code>https://example.org/customer/account/login</code></p>

<p>Il nous suffit de remplacer les <code>/</code> par des <code>_</code> :</p>

<pre><code>customer_account_login
</code></pre>

<p>En règle générale :</p>

<ul>
<li> En premier c'est le <strong>nom de la route</strong> (et pas du module !)</li>
<li> En deuxième c'est le <strong>nom du contrôleur</strong></li>
<li> En troisième c'est le <strong>nom de l'action</strong></li>
</ul>


<h2>Les blocks</h2>

<p>Le layout c'est plein de <code>block</code> qui ont tous deux attributs principaux :</p>

<ul>
<li> <code>type</code> ou <code>class</code> : indique la classe PHP du block (par exemple : <code>jbh_foo/bar</code> indique la classe <code>Jbh_Foo_Block_Bar</code> – à priori)</li>
<li> <code>name</code> : indique le nom du block dans le layout (doit être unique)</li>
</ul>


<p>On peut ensuite trouver d'autres attributs tels que :</p>

<ul>
<li> <code>template</code> : indique le path du fichier template <code>.phtml</code> utilisé par le block</li>
<li> <code>as</code> : indique le <em>nom</em> du block dans son parent</li>
<li> <code>translate</code> : indique les différentes balises qui peuvent être traduites (<code>label</code> est la valeur la plus utilisée)</li>
<li> <code>output</code> : indique la méthode du block à utiliser pour forcer l'affichage de celui-ci</li>
<li> <code>parent</code> : indique le nom du block parent (surcharge le parent réel dans le XML)</li>
<li> <code>before</code> : indique la place du block dans son parent (si la valeur est <code>-</code> alors le block sera ajouté tout au début de la liste des blocks enfants de son parent)</li>
<li> <code>after</code> : indique la place du block dans son parent (si la valeur est <code>-</code> alors le block sera ajouté tout à la fin de la liste des blocks enfants de son parent). Cet attribut n'est pas traité si <code>before</code> existe. Si la valeur est <code>-</code> et qu'un block est généré ensuite avec un <code>after="-"</code> alors ce dernier prendra la place en fin de liste.</li>
</ul>


<h3>Surcharger un block</h3>

<p>On peut surcharger un block dans le layout, pour changer son type par exemple !</p>

<p>Deux solutions :</p>

<ol>
<li>  Changer le type directement dans le fichier <code>.xml</code> qui déclare le block.</li>
<li>  Ajouter un nouveau block avec le même <code>name</code>.</li>
</ol>


<p>La première solution a l'avantage de ne pas créer d'instance de block inutilisée. Cependant elle a le désavantage d'obliger (bien souvent) le développeur à copier le fichier <code>.xml</code> du core dans son nouveau thème et à en modifier le contenu.</p>

<p>La seconde solution permet en fait d'écraser un block existant. Le problème dans ce cas c'est que lorsqu'on écrase le block, celui-ci disparaît du layout mais il reste dans son parent (sauf si on ajoute l'attribut <code>parent</code> à notre nouveau block, auquel cas il y a aussi un écrasement). On perd également toutes les opérations effectuée sur le vieux block, ainsi que tous ces enfants (qui sont toujours dans le layout mais qui étaient dans le block qu'on tente de remplacer).</p>

<p>En conclusion il est plus simple d'utiliser la première méthode. Cependant la seconde méthode peut avoir un avantage si on souhaite surcharger un block simple (qui n'a pas d'enfants) et sur lequel il n'y a pas eu d'<code>action</code> (voir plus bas « Les actions »).</p>

<h2>Les références</h2>

<p>Dans un <code>handle</code> on peut récupérer un block en utilisant une référence.</p>

<p>Une référence c'est juste un rappel du block pour permettre l'appel à des actions ou l'ajout de blocks enfants.</p>

<p>Une référence peut être insérée à n'importe quel endroit dans le handle : dans un block ou même dans une autre référence.</p>

<p>Un seul attribut est nécessaire (et obligatoire) pour la balise <code>reference</code> : l'attribut <code>name</code>. Celui-ci indique le nom du block à utiliser en tant que parent pour tout ce qui est dans le noeud <code>reference</code> en cours de traitement.</p>

<p>Par exemple pour faire une référence au content, pour y ajouter un block par exemple, sur toutes les pages (handle <code>default</code> donc) :</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;default&gt;</span>
    <span class="nt">&lt;reference</span> <span class="na">name=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;block</span> <span class="na">type=</span><span class="s">&quot;core/text_list&quot;</span> <span class="na">name=</span><span class="s">&quot;sub_content&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/reference&gt;</span>
<span class="nt">&lt;/default&gt;</span>
</code></pre></div>


<h2>Les actions</h2>

<p>Les actions sont très pratiques ! On utilise le XML du layout pour appeler des méthodes d'un block !</p>

<p>(La principale action utilisée est celle qui consiste à changer le template d'un block.)</p>

<p>Une <code>action</code> comprend 2 attributs :</p>

<ul>
<li> <code>method</code> : il est obligatoire, il indique la méthode du block à appeler (peut être une méthode magique ! si si  <code>;)</code>)</li>
<li> <code>block</code> : il est facultatif, il permet d'indiquer le block sur lequel l'action doit être appliquée.</li>
</ul>


<p>Une action fait donc appel à une méthode de son block :</p>

<ul>
<li> soit le block parent dans le Layout</li>
<li> soit le block précisé par l'attribut <code>block</code></li>
</ul>


<p>Dans les deux cas il faut préciser (sauf s'il n'y en a pas) les paramètres de la méthode.</p>

<p>Pour cela il suffit de suivre une logique simple :</p>

<ul>
<li> Le premier paramètre sera le premier enfant de l'action</li>
<li> Le second paramètre sera le second enfant de l'action</li>
<li> etc.</li>
</ul>


<p>Si bien que si nous avons par exemple la méthode suivante :</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">addLink</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$path</span><span class="p">,</span> <span class="nv">$label</span><span class="p">,</span> <span class="nv">$urlParams</span> <span class="o">=</span> <span class="k">array</span><span class="p">());</span>
</code></pre></div>


<p>Nous aurons l'action ci-dessous :</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;action</span> <span class="na">method=</span><span class="s">&quot;addLink&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;param1&gt;</span>name<span class="nt">&lt;/param1&gt;</span>
    <span class="nt">&lt;param2&gt;</span>path<span class="nt">&lt;/param2&gt;</span>
    <span class="nt">&lt;param3&gt;</span>label<span class="nt">&lt;/param3&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div>


<p>Nous ne mettons pas de 4ème balise car nous ne voulons pas préciser de 4ème paramètre lors de notre appel.</p>

<p>D'ailleurs... ce 4ème paramètre c'est un tableau !</p>

<p>Pour les tableaux c'est un peu plus compliqué...</p>

<p>Notez que bien souvent le nom d'une balise correspond au nom de la variable en paramètre de la méthode, pour plus de clareté (et uniquement pour cette raison, sauf pour les tableaux <code>;)</code>).</p>

<h3>Les tableaux en paramètre</h3>

<p>Pour un tableau de valeurs (indexé) il faut faire :</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;action</span> <span class="err">...</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tab&gt;</span>value_1<span class="nt">&lt;/tab&gt;</span>
    <span class="nt">&lt;tab&gt;</span>value_2<span class="nt">&lt;/tab&gt;</span>
    <span class="nt">&lt;tab&gt;</span>value_3<span class="nt">&lt;/tab&gt;</span>
    <span class="nt">&lt;tab&gt;</span>value_4<span class="nt">&lt;/tab&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div>


<p>Pour un tableau associatif il faut faire :</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;action</span> <span class="err">...</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tab&gt;</span>
        <span class="nt">&lt;cle_1&gt;</span>value_1<span class="nt">&lt;/cle_1&gt;</span>
        <span class="nt">&lt;cle_2&gt;</span>value_2<span class="nt">&lt;/cle_2&gt;</span>
        <span class="nt">&lt;cle_3&gt;</span>value_3<span class="nt">&lt;/cle_3&gt;</span>
    <span class="nt">&lt;/tab&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div>


<p>Et bien sûr on peut aller loin...</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;action</span> <span class="err">...</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tab&gt;</span>
        <span class="nt">&lt;cle_1&gt;</span>value_1<span class="nt">&lt;/cle_1&gt;</span>
        <span class="nt">&lt;cle_2&gt;</span>value_2<span class="nt">&lt;/cle_2&gt;</span>
        <span class="nt">&lt;cle_3&gt;</span>
            <span class="nt">&lt;cle_4&gt;</span>value_4<span class="nt">&lt;/cle_4&gt;</span>
            <span class="nt">&lt;cle_5&gt;</span>value_5<span class="nt">&lt;/cle_5&gt;</span>
            <span class="nt">&lt;cle_6&gt;</span>
                <span class="nt">&lt;cle_7&gt;</span>value_7<span class="nt">&lt;/cle_7&gt;</span>
                <span class="nt">&lt;cle_8&gt;</span>value_8<span class="nt">&lt;/cle_8&gt;</span>
            <span class="nt">&lt;/cle_6&gt;</span>
        <span class="nt">&lt;/cle_3&gt;</span>
    <span class="nt">&lt;/tab&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div>


<p>Et ainsi de suite !</p>

<p><em>Par contre à partir du second niveau vous ne pourrez plus faire de tableaux indexés.</em></p>

<h3>Changer le template d'un block</h3>

<p>Nous voulons par exemple changer le template de la page de login (template global).</p>

<p>D'abord il nous faut déterminer le handle de cette page le plus approprié. Le plus simple quand il faut modifier le template d'un block qui n'est que sur une seule page c'est d'utiliser le handle de l'action. Ici nous avons donc le handle suivant :</p>

<pre><code>customer_account_login
</code></pre>

<p>Ensuite nous devons trouver le block sur lequel nous devons changer le template.
Comme nous voulons changer le template global, le block est <code>root</code>.</p>

<p>Nous avons maintenant deux possibilités :</p>

<p>Soit on passe par une référence :</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;customer_account_login&gt;</span>
    <span class="nt">&lt;reference</span> <span class="na">name=</span><span class="s">&quot;root&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">method=</span><span class="s">&quot;setTemplate&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;template&gt;</span>customer/account/new_login.phtml<span class="nt">&lt;/template&gt;</span>
        <span class="nt">&lt;/action&gt;</span>
    <span class="nt">&lt;/reference&gt;</span>
<span class="nt">&lt;/customer_account_login&gt;</span>
</code></pre></div>


<p>Soit on utilise l'attribut <code>block</code> :</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;customer_account_login&gt;</span>
    <span class="nt">&lt;action</span> <span class="na">method=</span><span class="s">&quot;setTemplate&quot;</span> <span class="na">block=</span><span class="s">&quot;root&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;template&gt;</span>customer/account/new_login.phtml<span class="nt">&lt;/template&gt;</span>
    <span class="nt">&lt;/action&gt;</span>
<span class="nt">&lt;/customer_account_login&gt;</span>
</code></pre></div>


<p><strong>Il s'avère qu'il est d'ailleurs préférable de changer le template d'un block en utilisant l'attribut <code>block</code> plutôt qu'en utilisant une référence</strong> car c'est moins coûteux en ressources : on fait une itération en moins dans la génération des blocks. (c'est peu certes, mais c'est par là que passe l'optimisation... aussi)</p>

<h2>Ignorer un block</h2>

<p>On voit de temps en temps une petite ligne qui ressemble à ceci :</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;remove</span> <span class="na">name=</span><span class="s">&quot;left&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div>


<p>Cette balise permet d'ignorer un block. Ici on ignore le block <code>left</code> (la colonne de gauche).</p>

<p>Et il arrive assez fréquemment que le développeur se demande si le fait de mettre cette balise avant ou après la création d'un block aura un impact différent.</p>

<p>La réponse est <strong>non</strong>.</p>

<p>En effet, Magento utilise <em>XPATH</em> pour ignorer tous les noeuds et toutes les références aux noeuds dont le nom est indiqué dans l'attribut <code>name</code> de tous les tags <code>remove</code> du Layout.</p>

<p>Si vous ne voulez pas qu'un noeud soit finalement ignoré il faut réussir à supprimer le noeud <code>remove</code> qui le « supprime » ! (logique !)</p>

<p>(Sinon vous pouvez aller voir du côté du module <a href="http://alanstorm.com/magento_layout_unremove_in_local_xml">Layout UnRemove de Alan Storm</a>.)</p>

<p>La balise <code>remove</code> accepte l'attribut <code>acl</code> pour indiquer si on ignore ou non ce block dans le cas d'un layout admin. L'attribut prend la valeur du droit nécessaire pour afficher le block comme par exemple :</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;remove</span> <span class="na">name=</span><span class="s">&quot;foo&quot;</span> <span class="na">acl=</span><span class="s">&quot;jbh_foo/bar&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div>


<p>Si l'administrateur connecté a le droit <code>jbh_foo/bar</code> alors le block ne sera pas ignoré.</p>

<p>A noter aussi qu'on peut inhiber l'action du remove sur un block en définissant l'attribut <code>ignore</code> de celui-ci !</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;block</span> <span class="na">name=</span><span class="s">&quot;foo&quot;</span> <span class="na">type=</span><span class="s">&quot;core/text_list&quot;</span> <span class="na">ignore=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div>


<p>Ce block ne pourra donc pas être supprimé via <code>remove</code>. Attention par contre... vu qu'on ne peut pas ajouter un attribut à un block déjà existant (via une référence par exemple) cette manipulation implique que le block ne sera <strong>jamais</strong> ignoré.</p>

<h2>Le fichier <code>local.xml</code> (dans <code>design/../layout/</code>)</h2>

<p>Surprise ! Ce fichier est toujours parsé en dernier ! Donc si vous souhaitez faire de la mise à jour pour un thème sans rien en particulier vous pouvez utiliser ce fichier.</p>

<p>C'est bon à savoir non ?</p>

<p>Avec lui, plus besoin de faire un module pour « nettoyer » votre thème :)</p>

<h2>Un recherché remplacé ?</h2>

<p>Oui ! Magento effectue un <code>str_replace</code> sur tout votre XML comme ceci :</p>

<ul>
<li><code>{{baseUrl}}</code> devient l'URL non sécurisée de votre store</li>
<li><code>{{baseSecureUrl}}</code> devient l'URL sécurisée de votre store</li>
</ul>


<h2>Les updates</h2>

<p>Un update c'est simplement un bout de XML ajouté au layout qui sera traité de la même façon que tous les fichiers <code>.xml</code> de votre thème.</p>

<h3>Le tag <code>update</code></h3>

<p>Il ne peut être qu'un enfant d'un <em>handle</em>, sinon il ne sera pas pris en compte.</p>

<p>Il doit comporter un seul attribut : <code>handle</code>.</p>

<p>Cet attribut indique le nom d'un autre <em>handle</em> qui doit être pris en compte dans le layout.</p>

<p>Vous pouvez par exemple vouloir appliquer le handle <code>customer_account</code> à votre nouvelle page pour qu'elle s'intègre parfaitement dans la partie "Mon Compte" du client :</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;handle_de_ma_nouvelle_page&gt;</span>
    <span class="nt">&lt;update</span> <span class="na">handle=</span><span class="s">&quot;customer_account&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/handle_de_ma_nouvelle_page&gt;</span>
</code></pre></div>


<p>Vous pouvez également utiliser cette technique pour éviter de dupliquer un gros bout de layout que vous voudriez réutiliser !</p>

<h3>Des updates en base de données</h3>

<p>Les Widgets utilisent la base de données pour ajouter des updates sur le layout.</p>

<p>Il nous est possible de faire de même si on le souhaite en utilisant les deux tables <code>core_layout_link</code> et <code>core_layout_update</code>.</p>

<p>Désactiver le module des Widgets n'empêchera pas Magento de faire une requête <code>SELECT</code> par <em>handle</em> par page.</p>

<p>Donc si vous n'avez pas de cache, sachez que Magento fait au <strong>minimum</strong> 4 requêtes pour récupérer les possibles <em>layout updates</em> en base de données à chaque chargement.</p>

<p>A savoir que la sauvegarde d'un seul Widget invalidera les caches suivants :</p>

<ul>
<li> Le cache « Blocks HTML output  » (<code>block_html</code>)</li>
<li> Le cache « Layouts » (<code>layout</code>)</li>
</ul>


<p>Merci les widgets ! (à utiliser avec parcimonie donc...)</p>

<h2>Conclusion</h2>

<p>Vous maîtrisez maintenant le layout sur Magento ! Au moins vous avez les connaissances... Vous savez comment créer, modifier, supprimer tout ou partie du Layout. Il ne vous manque plus que la pratique !</p>

<p>A présent n'hésitez surtout pas à laisser un commentaire sur vos astuces bien à vous ;) Ou simplement pour réagir à cet article !</p>

 -->



    </div>
    <div class="voirPlus">
        <div class="social">
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/le-layout-sur-magento.html" data-text="Le Layout sur Magento" data-via="jacquesbh">Tweet</a>
        </div>
        
        <a href="/le-layout-sur-magento.html#disqus_thread">Commentaires</a> -
        

        <a href="/le-layout-sur-magento.html">Lire l'article</a>

    </div>

    <hr />
    <h2><a href="/le-cache-des-blocks-sur-magento.html">Le cache des blocks sur Magento</a></h2>
    <div class="content post">
        <p>Le cache block sur Magento... Quelle galère !</p>

<p>Enfin... à ce qu'on dit.</p>

<blockquote><p>Je comprends rien... c'est quoi <code>cache_tags</code> ?</p>

<p>C'est comme <code>cache_key</code> ?</p></blockquote>

<p>Je ne suis pas de cet avis en fait. Le cache c'est <em>easy</em>, il suffit <em>juste</em> de savoir où on met les pieds !</p>

<p>Vous me suivez ?</p>

<!-- 


<hr />

<h2>Les bases du cache sur Magento</h2>

<p>Avant d'attaquer le cache sur les blocks il vous faut savoir quelques petites choses sur le cache en général sur Magento.</p>

<h3>La clé, ou <code>cache_key</code></h3>

<p>Une clé le plus souvent c'est <strong>unique</strong> ! Bah là, c'est pareil.</p>

<p>Un cache est identifié par sa clé. Un changement minime dans le contenu de votre cache doit faire varier sa clé !</p>

<p>Sauf bien sûr si vous ne souhaitez pas avoir les deux versions.</p>

<p>Par exemple on peut mettre en cache la réponse d'une requête SQL, à condition de faire en sorte que la clé soit liée à l'identifiant dans la clause <code>WHERE</code> de votre requête !</p>

<p>Sinon c'est la <em>loose</em>... Prenons un exemple <em>bidon</em> :</p>

<script src="https://gist.github.com/3646203.js?file=example_01.php"></script>


<p>On peut voir que la clé ne change pas car elle dépend de la variable <code>$_cacheKey</code> qui ne change pas entre le premier et le second appel à la méthode <code>getCountLessThan</code>.</p>

<p>Maintenant si on change la valeur de <code>$_cacheKey</code> à <code>jbh_counter_sql_result_%d</code> le résultat n'est plus le même !</p>

<script src="https://gist.github.com/3646203.js?file=example_02.php"></script>


<p><strong>La clé est donc vraiment importante dans la gestion du cache !</strong></p>

<h3>La durée de vie, ou <code>cache_lifetime</code></h3>

<p>Là c'est simple ! On peut décider de donner une durée de vie à notre cache (en secondes).</p>

<p>En gros si notre cache est vieux de plus de <code>cache_lifetime</code> secondes, alors on le supprime et il est généré à nouveau.</p>

<p><strong>Les valeurs de <code>cache_lifetime</code></strong> :</p>

<ul>
<li><code>null</code> : pas de cache</li>
<li><code>false</code> : 7200 secondes de cache, soit 2 heures</li>
<li><code>(int)</code> : nombre de secondes de cache</li>
<li><code>-(int)</code> : équivaut à pas de cache (date d'expiration du cache dépassée dès la prochaine demande)</li>
</ul>


<h3>Les tags, ou <code>cache_tags</code></h3>

<p>Tagguer un cache... <em>Wait... WHAT?</em></p>

<p>En toute logique quand on veut vider un cache on indique sa clé et on supprime le cache concerné.</p>

<p>Sauf qu'en pratique... bah c'est franchement la merde. Et c'est là que les tags font leur entrée !</p>

<p>Imaginons plusieurs caches avec chacun une liste de tags :</p>

<script src="https://gist.github.com/3646203.js?file=example_03.txt"></script>


<p>Maintenant, si on veut vider les caches <code>A</code> et <code>B</code> on fait tout simplement :</p>

<script src="https://gist.github.com/3646203.js?file=example_04.php"></script>


<p>Par défaut Magento fait en sorte que si un tag <em>match</em> un cache celui-ci soit supprimé. Si vous avez renseigné plusieurs tags à vider, <strong>tous</strong> les cache concernés par <strong>un ou plusieurs</strong> de ces tags seront supprimés.</p>

<p>Si vous souhaitez supprimer un cache (sur le cache <code>frontend</code>, pas le cache <code>backend</code>) qui <em>match</em> tous les tags renseignés il faut faire :</p>

<script src="https://gist.github.com/3646203.js?file=example_05.php"></script>


<p>Ici on a vidé le cache du <code>C</code>.</p>

<h2>Le cache sur les blocks</h2>

<p>Par défaut un block n'a pas de cache car la méthode <code>getCacheLifetime</code> du block <code>Mage_Core_Block_Abstract</code> retourne <code>null</code> si aucune <em>data</em> <code>cache_lifetime</code> n'est renseignée.</p>

<p>La gestion du cache sur les blocks utilise le fait que chaque block est un <code>Varien_Object</code> pour stocker les valeurs de <code>cache_key</code>, <code>cache_lifetime</code> et <code>cache_tags</code>.</p>

<p>Sauf que qui dit <code>Varien_Object</code> dit <code>__call</code>... non ?</p>

<p>Donc en fait les variables du cache sont récupérées de la manière suivante :</p>

<script src="https://gist.github.com/3646203.js?file=example_06.php"></script>


<p>Donc ? Bah donc on peut surcharger sur nos blocks. Et oui !</p>

<h3>La clé avec <code>getCacheKey()</code></h3>

<p>Comme on le sait la clé doit être unique et dépendre du contexte. On a donc plusieurs paramètres à prendre en compte :</p>

<ul>
<li>Le store (donc la locale en passant)</li>
<li>Le design (package &amp; thème)</li>
<li>Le template <code>phtml</code> utilisé</li>
<li>Le nom du block dans le Layout</li>
<li>Un identifiant (identifiant d'un produit par exemple)</li>
</ul>


<p>On peut bien sûr ajouter des paramètres dans notre clé.</p>

<p>Bon, mais en gros, quand on a un tableau de paramètres et qu'on veut une chaîne de caractères on fait comment ? <code>implode</code> ? Avec un <em>hash</em> ?</p>

<p>Soyons fous !</p>

<p>Mais en fait... Magento le fait pour nous ; avec l'appel à <code>getCacheKeyInfo()</code> dans <code>getCacheKey()</code> :</p>

<script src="https://gist.github.com/3646203.js?file=example_07.php"></script>


<p>Si on y regarde de plus près on remarque que la méthode <code>getCacheKeyInfo()</code> retourne un tableau qui contient une seule valeur : le nom du block dans le Layout :</p>

<script src="https://gist.github.com/3646203.js?file=example_08.php"></script>


<p>Dans notre block, on surcharge cette méthode !</p>

<script src="https://gist.github.com/3646203.js?file=example_09.php"></script>


<h3>Les tags avec <code>getCacheTags()</code></h3>

<p>Par défaut on essaiera toujours de donner une constante <code>CACHE_TAG</code> à un modèle concocté par nos soins par exemple. A nous de ne pas oublier de l'utiliser !</p>

<p>L'intérêt de définir une constante <code>CACHE_TAG</code> à nos modèles qui sont utilisés dans nos blocks c'est de pouvoir vider le cache de tous les blocks concernés par nos objets lorsqu'on les sauvegarde par exemple !</p>

<p>Il suffit de modifier la méthode <code>_afterSave</code> de nos modèles pour y ajouter le clean du cache !</p>

<p>Revenons à nos moutons et voyons à quoi ressemble la méthode <code>getCacheTags</code> par défaut de Magento :</p>

<script src="https://gist.github.com/3646203.js?file=example_10.php"></script>


<p>Allez, on surcharge dans notre block !</p>

<p>J'ajoute ici un exemple <em>vite fait</em> d'un modèle avec une constante <code>CACHE_TAG</code> bien utilisée :</p>

<script src="https://gist.github.com/3646203.js?file=example_11.php"></script>


<p>Vous noterez qu'on peut ajouter n'importe quels tags. Attention cependant à ne pas oublier les tags par défaut récupérés grâce au <code>parent</code> !</p>

<h3>La durée de vie avec <code>getCacheLifetime()</code></h3>

<p>Rien de plus simple !</p>

<script src="https://gist.github.com/3646203.js?file=example_12.php"></script>


<h2>Pensez à vider le cache !</h2>

<p>Utilisez bien les tags enregistrés avec le cache de vos blocks pour vider tout ça !</p>

<p>Vous pouvez aussi enregistrer tous les tags utilisés sur les blocks par défaut d'une page de cette manière :</p>

<p>Dans le fichier <code>/app/code/core/Mage/Core/Model/App.php</code>, ajoutez un log dans la méthode <code>saveCache</code> :</p>

<script src="https://gist.github.com/3646203.js?file=example_13.php"></script>


<p>Vous aurez ici les tags utilisés ! Mais pas ceux qui ne sont pas utilisés, mais vidés !</p>

<p>Dans le fichier <code>/app/code/core/Mage/Core/Model/App.php</code>, ajoutez un log dans la méthode <code>cleanCache</code> :</p>

<script src="https://gist.github.com/3646203.js?file=example_14.php"></script>


<h2>Conclusion</h2>

<p>Gérer le cache des blocks n'est pas une mince affaire mais on s'y retrouve !</p>

<p>Il faut juste savoir s'y prendre.</p>

<p>Vous pouvez également utiliser la méthode <code>addData</code> dans la surcharge du constructeur secondaire <code>protected function _construct()</code> de votre block pour y assigner les valeurs de <code>cache_key</code>, <code>cache_tags</code> et <code>cache_lifetime</code> mais je le déconseille.</p>

<p>Bon cache !</p>

 -->



    </div>
    <div class="voirPlus">
        <div class="social">
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/le-cache-des-blocks-sur-magento.html" data-text="Le cache des blocks sur Magento" data-via="jacquesbh">Tweet</a>
        </div>
        
        <a href="/le-cache-des-blocks-sur-magento.html#disqus_thread">Commentaires</a> -
        

        <a href="/le-cache-des-blocks-sur-magento.html">Lire l'article</a>

    </div>

    <hr />
    <h2><a href="/git-en-entreprise.html">Git en entreprise</a></h2>
    <div class="content post">
        <p><em>Mise à jour du 1er décembre 2013 : Sinon <a href="https://github.com/nvie/gitflow">git flow</a> c'est pas mal aussi ;)</em></p>

<p>Je suis actuellement en poste dans deux entreprises :</p>

<ol>
<li>Lead développeur chez <a href="http://joliebox.com">JolieBox</a>, où je passe mes connaissances car mon départ est prévu pour le 1er octobre 2012.</li>
<li>Lead développeur chez <a href="http://www.internim.com">Internim</a> où j'arrive petit à petit pour prendre en main tout ou partie du Lead sur certains projets et pour animer un peu les développeurs.</li>
</ol>


<p>J'ai une problématique qui se présente à la fois chez JolieBox et à la fois chez Internim : <strong>Notre workflow git</strong>.</p>

<p>L'idée de cet article est de permettre aux développeurs de savoir quelles commandes utiliser, et dans quels cas !</p>

<p>Rien de mieux qu'un bon exemple. Vous allez avoir du concret !</p>

<!-- 


<hr />

<h2>Les branches</h2>

<p>Avant mon arrivée chez Internim nous avons décidé, chez JolieBox, de travailler avec une branche par développeur.</p>

<p>Chaque développeur a donc une branche qui lui est propre, nommée le plus souvent par son pseudo ou son nom : <code>jbh</code> pour moi !</p>

<p>A ce moment là nous avons établi le fonctionnement :</p>

<ul>
<li>Une branche par développeur.</li>
<li>Une branche <code>master</code>.</li>
<li>Une branche <code>dev</code> si besoin.</li>
<li>Une branche supplémentaire par gros lot de développements.</li>
</ul>


<p>A mon arrivée chez Internim j'ai découvert que le fonctionnement était le même sur les projets sous <em>Git</em>, avec quelques branches en plus :</p>

<ul>
<li>Une branche <code>integration</code> qui contient donc l'intégration du projet (agence web oblige).</li>
<li>Une branche <code>recette</code> qui contient la dernière release du projet.</li>
<li>Une branche <code>demo</code> qui permet surtout d'avoir une environnement adapté.</li>
</ul>


<p>Nous sommes donc sur un schéma assez complexe car nous avons un minimum de 3 branches chez JolieBox et 6 branches chez Internim.</p>

<p>Si à cela on ajoute au moins 3 ou 4 branches pour les développeurs, ça devient rapidement un beau bordel. Et nous ne sommes pas dans des process de releases comme <em>Debian</em> ou autre.</p>

<h2>Les développements</h2>

<p>J'ai lu <a href="http://nvie.com/posts/a-successful-git-branching-model/">un très bon article</a> qui résume bien le fonctionnement que je vais vous expliquer ici.</p>

<h3>git commit</h3>

<p>On ne vous la présente pas ! Comment faire nos commits sans cette ligne de commande ?</p>

<p>La meilleure.</p>

<h3>git checkout</h3>

<p>La commande <code>git checkout</code> permet donc de changer de branche.
Elle est utilisée dans le cas où on doit se placer dans l'état d'une autre branche (la <code>master</code> pour un <em>hotfix</em> par exemple).
Elle est aussi utilisée avant de faire un <code>git merge</code>.</p>

<h3>git merge</h3>

<p>La commande <code>git merge</code> permet de <em>merger</em> une branche sur la branche courante.</p>

<p>Imaginez que vous êtes sur la branche <code>jbh</code> et que vous devez merger cette branche <code>jbh</code> sur la <code>master</code> :</p>

<pre><code>$ git checkout master
$ git merge jbh
</code></pre>

<p>Rien de plus.</p>

<p>L'option <code>--no-ff</code> permet de ne pas faire de <em>fast-forward</em> et de forcer la création d'un commit.</p>

<h3>git cherry-pick</h3>

<p>J'adore cette commande. Elle permet de récupérer un commit...</p>

<blockquote><p>(RTFM)</p>

<p>git-cherry-pick - Apply the changes introduced by some existing commits</p></blockquote>

<p>Je l'utilise quand je dois appliquer un hotfix sur ma branche par exemple. Plutôt qu'un merge...</p>

<h2>Par l'exemple</h2>

<p>Rien ne vaut un exemple pour bien comprendre tout ça.</p>

<p>Prenons les branche suivantes :</p>

<ul>
<li>master</li>
<li>dev</li>
<li>recette</li>
<li>demo</li>
<li>dev1 (développeur 1)</li>
<li>dev2 (développeur 2)</li>
<li>dev3 (développeur 3)</li>
</ul>


<p>Et établissons l'historique suivant : (Espace de travail du <em>Développeur 2</em>)</p>

<pre><code>* Added f  (origin/dev3)
* Added e 
| * Added d  (HEAD, origin/dev2, dev2)
| * Added c 
|/  
| * Added b  (origin/dev1)
|/  
* Added a  (origin/recette, origin/master, origin/dev, origin/demo, origin/HEAD, master)
</code></pre>

<p>On peut voir que les développeurs on avancé chacun de leur côté au départ de la master.</p>

<h3>La branche <code>dev</code></h3>

<p>Le <em>Développeur 2</em> veut merger sa branche sur la <code>dev</code> car il a terminé ses développements :</p>

<pre><code>$ git checkout dev
$ git merge --no-ff dev2
$ git push origin dev
</code></pre>

<p>Et voici ce que ça donne :</p>

<pre><code>*   Merge branch 'dev2' into dev  (HEAD, origin/dev, dev)
|\  
| * Added d  (origin/dev2, dev2)
| * Added c 
|/  
| * Added f  (origin/dev3)
| * Added e 
|/  
| * Added b  (origin/dev1)
|/  
* Added a  (origin/recette, origin/master, origin/demo, origin/HEAD, master)
</code></pre>

<p>Il se trouve que le <em>Développeur 2</em> se trouve sur la dernière révision de la <code>dev</code>, il peut donc reprendre ses développements.</p>

<pre><code>$ git checkout dev2
[quelques commits...]
$ git push origin dev2
</code></pre>

<p>On remarque que le merge de <code>dev2</code> sur <code>dev</code> n'a impacté que la branche <code>dev</code>.
Il faut savoir que <strong>le merge n'impacte QUE la branche courante</strong>.</p>

<pre><code>* Added h  (HEAD, origin/dev2, dev2)
* Added g 
| *   Merge branch 'dev2' into dev  (origin/dev, dev)
| |\  
| |/  
|/|   
* | Added d 
* | Added c 
|/  
| * Added f  (origin/dev3)
| * Added e 
|/  
| * Added b  (origin/dev1)
|/  
* Added a  (origin/recette, origin/master, origin/demo, origin/HEAD, master)
</code></pre>

<p>Maintenant c'est au tour du <em>Développeur 1</em> de vouloir merger sur la <code>dev</code>.</p>

<pre><code>$ git checkout dev
$ git fetch
$ git merge origin/dev
$ git merge --no-ff dev1
$ git push origin dev
</code></pre>

<p>Le résultat : La branche <code>dev</code> est à jour avec les commits des développeurs 1 et 2. Cependant le <em>Développeur 1</em> n'a pas dans sa branche <code>dev1</code> les commits de la branche <code>dev2</code> et le <em>Développeur 2</em> n'a pas ceux de la branche <code>dev1</code> dans sa branche <code>dev2</code>.</p>

<p>Le <em>Développeur 1</em> sait que sa branche n'est pas totalement à jour. Il décide donc de faire en sorte qu'elle le soit pour pouvoir continuer ses développements.</p>

<p>Pour ça il décide de replacer sa branche <code>dev1</code> à l'identique de la branche <code>dev</code>. On reset :</p>

<pre><code>$ git checkout dev1
$ git reset --hard dev
$ git push -f origin dev1
</code></pre>

<p>D'après un collègue chez <a href="http://www.internim.com">Internim</a> on peut aussi faire un pull/push de la branche sur laquelle on veut se placer : <em>(testé et approuvé)</em></p>

<pre><code>$ git checkout dev1
$ git pull origin dev
$ git push origin dev1
</code></pre>

<p>Le <em>Développeur 1</em> est maintenant précisément au même endroit que la branche <code>dev</code>, il peut donc continuer ses développements avec deux nouveaux commits :</p>

<pre><code>* Added j  (HEAD, origin/dev1, dev1)
* Added i 
*   Merge branch 'dev1' into dev  (origin/dev, dev)
|\  
| * Added b 
* |   Merge branch 'dev2' into dev 
|\ \  
| |/  
|/|   
| | * Added h  (origin/dev2)
| | * Added g 
| |/  
| * Added d 
| * Added c 
|/  
| * Added f  (origin/dev3)
| * Added e 
|/  
* Added a  (origin/recette, origin/master, origin/demo, origin/HEAD, master)
</code></pre>

<p>Vient le tour du <em>Développeur 3</em> de faire son merge sur la branche <code>dev</code> (rapidement) :</p>

<pre><code>$ git checkout dev
$ git fetch
$ git merge origin/dev
$ git merge --no-ff dev3
$ git push origin dev
$ git checkout dev3
</code></pre>

<p>On remarque que la branche <code>dev</code> ne contient <strong>QUE</strong> des merges. C'est super car c'est exactement ce que nous voulons !</p>

<pre><code>*   Merge branch 'dev3' into dev  (origin/dev, dev)
|\  
| * Added f  (HEAD, origin/dev3, dev3)
| * Added e 
| | * Added j  (origin/dev1)
| | * Added i 
| |/  
|/|   
* |   Merge branch 'dev1' into dev 
|\ \  
| * | Added b 
| |/  
* |   Merge branch 'dev2' into dev 
|\ \  
| |/  
|/|   
| | * Added h  (origin/dev2)
| | * Added g 
| |/  
| * Added d 
| * Added c 
|/  
* Added a  (origin/recette, origin/master, origin/demo, origin/HEAD, master)
</code></pre>

<p>Au tour du <em>Développeur 3</em> de replacer sa branche pour continuer ses développements correctement :</p>

<pre><code>$ git checkout dev3
$ git reset --hard dev
$ git push -f origin dev3
</code></pre>

<p>On peut aussi faire un pull de la branche <code>dev</code> :</p>

<pre><code>$ git checkout dev3
$ git pull origin dev
$ git push origin dev3
</code></pre>

<p><strong>Bien sûr un <code>reset --hard</code> suivi d'un <code>push -f</code> implique que votre environnement de travail soit vraiment propre avant toute manipulation.</strong></p>

<h3>La branche <code>recette</code></h3>

<p>On ne merge sur la <code>recette</code> que quand les développements sont validés. C'est à ce moment là que le chef de projets fait ses vérifications par rapport aux spécifications techniques générales et détaillées.</p>

<p>N'importe qui peut faire le merge de la <code>dev</code> sur la <code>recette</code> car on sait que seule la branche courante est impactée.</p>

<p>On merge la branche <code>origin/dev</code> pour être certain de prendre la dernière version :</p>

<pre><code>$ git checkout recette
$ git fetch
$ git merge origin/recette
$ git merge --no-ff origin/dev
$ git push origin recette
</code></pre>

<p>La branche <code>recette</code> contient bien nos derniers développements.</p>

<pre><code>*   Merge remote-tracking branch 'origin/dev' into recette  (HEAD, recette)
|\  
| *   Merge branch 'dev3' into dev  (origin/dev3, origin/dev, dev3, dev)
| |\  
| | * Added f 
| | * Added e 
| |/  
|/|   
| | * Added j  (origin/dev1)
| | * Added i 
| |/  
| *   Merge branch 'dev1' into dev 
| |\  
| | * Added b 
| |/  
|/|   
| *   Merge branch 'dev2' into dev 
| |\  
|/ /  
| | * Added h  (origin/dev2)
| | * Added g 
| |/  
| * Added d 
| * Added c 
|/  
* Added a  (origin/recette, origin/master, origin/demo, origin/HEAD, master)
</code></pre>

<h3>La branche <code>demo</code></h3>

<p>Le principe est identique à la branche <code>recette</code> sauf que c'est bien la branche <code>recette</code> que l'on merge sur la <code>demo</code>.</p>

<h3>La branche <code>master</code></h3>

<p>C'est un peu la branche de <em>prod</em>...</p>

<p>Même principe, on merge la branche <code>demo</code> sur la <code>master</code>.</p>

<h3>Les hotfixes ?</h3>

<p>C'est le dernier point important !</p>

<p>A un moment il est fort possible que vous ayez à faire un <em>hotfix</em> sur la branche <code>recette</code> par exemple.</p>

<p>Faites-le ! Et appliquez la modification sur la branche <code>dev</code> pour être certain que les développeurs récupèrerons la modification à un moment.</p>

<p>Pour ça vous pouvez procéder comme suit :</p>

<h4>Appliquer le hotfix</h4>

<pre><code>$ git checkout recette
[...fix...]
$ git fetch
$ git merge origin/recette
$ git commit -m "[hotfix] Added k"
$ git push origin recette
</code></pre>

<p>Il nous faut maintenant appliquer le commit sur toutes les <em>principales</em> branches du projet au dessus dans la hiérarchie des merges.</p>

<p>Dans ce cas au dessus de <code>recette</code> : c'est <code>dev</code>.</p>

<h4>Appliquer le hotfix sur la branche <code>dev</code></h4>

<p>Les branches <code>dev1</code>, <code>dev2</code> et <code>dev3</code> ne sont pas à impacter. Si votre équipe est bien organisée elle verra passer le <em>hotfix</em> et le récupèrera.</p>

<p>Soit de la manière que je vais vous montrer, soit via un reset comme nous l'avons vu plus haut.</p>

<p>Appliquez donc le hotfix sur la branche <code>dev</code> via la commande <code>git cherry-pick</code> !</p>

<p>Il vous faut au préalable le SHA1 du hotfix (au moins les premiers caractères) :</p>

<pre><code>$ git checkout dev
$ git fetch
$ git merge origin/dev
$ git cherry-pick 461c1ca
$ git push origin dev
</code></pre>

<h2>Conclusion</h2>

<p>Je ne suis pas certain que ce workflow soit le meilleur mais il a le mérite de fonctionner. Il permet de garder une arborescence propre.</p>

<p>Le fait de <code>reset --hard</code> la branche du développeur est assez particulier, mais c'est la seule manière que j'ai trouvé pour ne pas faire de duplicats de commits (comme on peut le voir avec <code>rebase</code>)
C'est essentiellement à cause de ces <code>reset</code> que je force le commit lors des merges avec l'option <code>--no-ff</code>. De cette manière mon historique indique bien qu'il y a eu un merge de tel développeur à tel moment.</p>

<p>Vos avis sont les bienvenus !</p>

 -->



    </div>
    <div class="voirPlus">
        <div class="social">
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/git-en-entreprise.html" data-text="Git en entreprise" data-via="jacquesbh">Tweet</a>
        </div>
        
        <a href="/git-en-entreprise.html#disqus_thread">Commentaires</a> -
        

        <a href="/git-en-entreprise.html">Lire l'article</a>

    </div>


<div class="pagination">
    <hr/>
    
    
    
    <a href="/page3" class="previous">Précédent</a>
    
    –
    
    
    <span class="page_number">Page 4 sur 7</span>
    
    
    –
    <a href="/page5" class="next">Suivant</a>
    
    
</div>



</div>

<script type="text/javascript">
    var disqus_shortname = 'jacquesbh';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



    </div>

    <div id="bottomWrap">
        <div id="contactWrap">
            <form action="#" method="post" id="contact_form">
                <h3>Contact</h3>
                <p>
                    <label for="contactNom">Votre nom</label>
                    <input type="text" name="contact_name" id="contact_name" class="text" tabindex="1" />
                </p>
                <p>
                    <label for="contactEmail">Votre email</label>
                    <input type="email" name="contact_email" id="contact_email" class="text" tabindex="2" />
                </p>
                <p>
                    <label for="contactMessage">Message</label>
                    <textarea name="contact_message" id="contact_message" rows="5" cols="30" tabindex="8"></textarea>
                </p>
                <p class="send">
                    <input type="hidden" name="redirect_to" value="http://jacques.sh/contact/thanks.html" />
                    <input type="submit" id="contactSend" value="Envoyer" tabindex="9" />
                </p>
                <div style="display: none;" class="url">http://getsimpleform.com/messages?form_api_token=4ba030c3b67553e1ccb25710aee63bd6</div>
            </form>
            <div class="qrcode">
                <h3>Mon QRcode</h3>
                <p>
                    <img src="/img/qrcode.png" alt="le QRcode" width="198" height="192" />
                </p>
            </div>
        </div>

        <div id="footerWrap">
            <div class="social">
                <a href="https://twitter.com/jacquesbh" class="twitter-follow-button" data-show-count="false">Follow @jacquesbh</a>
            </div>
            
            <a href="http://monsieurbiz.com" title="Découvrez Monsieur Biz, une agence spécialisée sur Magento, solution e-commerce">Agence Magento</a>
            | 

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <a href="/credits.html">Crédits</a>
        
    

    
        
    

    
        
    

    
        
            |
            <a href="/legals.html">Informations légales</a>
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    





            | <a href="/atom.xml">RSS</a>
            | <a href="#" id="toplink">Haut de page</a>
            <br />
            <span class="copy">&copy; Jacques Bodin-Hullin - 2014</span>
        </div>
    </div>

</div>




  <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-27192340-2', 'auto');
  ga('send', 'pageview');

</script>






<script type="text/javascript" src="/js/jquery/cookies.js"></script>
    <div id="popin" class="monsieurbiz-popin" style="display: none;">
        <img src="/img/monsieurbiz.png" alt="" height="250" style="height: 250px;" />
        <h2><span class="lines">Un projet, Une agence</span></h2>
        <div class="action">
            <p>
                Monsieur Biz, une agence spécialisée Magento pour votre projet.
            </p>
            <a href="http://monsieurbiz.com">
                <div class="button1">C'est par ici que ça se passe !</div>
            </a>
        </div>
    </div>

    <script type="text/javascript">
    if (typeof disable_popin === 'undefined' || !disable_popin) {
        (function ($) {
            $(document).ready(function () {
                var cookieId = 'monsieurbizPopinDisplayed';
                if ($.cookie(cookieId) == null) {
                    $.fancybox.open('#popin');
                    $.cookie(cookieId, 'true');
                }
            });
         })(jQuery);
    }
    </script>


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</body>
</html>

