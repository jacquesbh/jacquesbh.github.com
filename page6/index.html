

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <title>Des articles sur Magento et plein d'autres choses ! - Jacques Bodin-Hullin, développeur Magento</title>
    
    
    <meta name="author" content="Jacques Bodin-Hullin">
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/js/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
    <link rel="alternate" type="application/rss+xml" title="Jacques Bodin-Hullin - Latest Posts" href="/atom.xml" >

    <script type="text/javascript" src="/js/jquery-1.10.2.min.js" ></script>
    <script type="text/javascript" src="/js/fancybox/jquery.fancybox.pack.js" ></script>
    <script type="text/javascript" src="/js/event.js" ></script>
    <script type="text/javascript" src="/js/functions.js" ></script>

    <style for="gists"></style>
</head>
<body class="">

<div id="mainWrap">

    <div id="topWrap">
        <div id="headerWrap">
            <p>
                Jacques Bodin-Hullin
                <span class="baseline">Développeur d'applications Web</span>
            </p>
            <a href="http://jacques.sh"></a>

            <div id="magento_certified">
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin, développeur certifié Magento Developer" class="developer" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="L'Agence Monsieur Biz est certifiée Magento Developer Plus" class="developer-plus" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin est développeur certifié Magento Front End Developer" class="frontend-developer" target="_blank"></a>
            </div>

        </div>

        <blockquote id="quoteWrap">
            
            <p>
                La perfection est atteinte non quand il ne reste rien à ajouter, mais quand il ne reste
                rien à enlever.
            </p>
            <div><cite>Antoine de Saint Exupéry</cite></div>
            
        </blockquote>

        <ul id="menu">
            
            <li><a href="/"><span></span>Accueil</a></li>
            
            <li><a href="https://github.com/jacquesbh" target="_blank"><span></span>Code</a></li>
            
            
    
        
    

    
        
            
            <li><a href="/a-propos.html"><span></span>A propos</a></li>
            
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <li><a href="/references.html"><span></span>Références</a></li>
            
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    




            <li class="search">
                <form action="/search.html" method="get" id="search_form">
                    <div>
                        <input type="text" name="q" placeholder="Votre recherche" />
                    </div>
                </form>
            </li>
        </ul>

        <div class="mbiz">
            <p>
                <a href="http://monsieurbiz.com" title="Découvrez l'agence Monsieur Biz, spécialiste Magento">
                    <img src="/img/monsieurbiz_bg.png" title="L'Agence Monsieur Biz" />
                    <span>Vous cherchez une agence à taille humaine spécialisée sur la solution e-commerce Magento ? L'agence Monsieur Biz est faite pour vous.</span>
                </a>
            </p>
        </div>
    </div>

    <div id="globalWrap">



<div id="sideWrap">

<h2>A propos</h2>
<div>
    <img src="/img/visage_edito.png" alt="" width="277" height="88" />
    <p>Bienvenue sur mon blog !</p>
    <p>Je suis <a href="/a-propos.html">Jacques Bodin-Hullin, développeur PHP confirmé, certifié Magento</a>.</p>
    <p>Ce blog est dédié au développement, PHP essentiellement, Javascript un peu, et tout le reste, évidemment !</p>
    <p>N'hésitez pas à aller faire un tour <a href="https://github.com/jacquesbh">sur mon github</a> afin de suivre mes projets et à poster vos remarques sur les articles que vous trouvez ici, c'est toujours constructif !</p>
    <p>J'espère que vous trouverez ici l'information que vous cherchez.</p>
</div>

<div>
    <p>Je suis également le fondateur de <a href="http://monsieurbiz.com">Monsieur Biz, une agence spécialisée Magento</a>.</p>
</div>

<hr />




<h2>Tags</h2>

<p class="tags">

    <span style="font-size:14.4px"><a href="/search.html#!tag=Jekyll">Jekyll</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Markdown">Markdown</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=GitHub">GitHub</a></span>

    <span style="font-size:37.2px"><a href="/search.html#!tag=Magento">Magento</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Snippets">Snippets</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Vim">Vim</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Netbeans">Netbeans</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=jQuery">jQuery</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Javascript">Javascript</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=PHP">PHP</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=URL">URL</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=Bonnes pratiques">Bonnes pratiques</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Ajax">Ajax</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Homepage">Homepage</a></span>

    <span style="font-size:16.8px"><a href="/search.html#!tag=Layout">Layout</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=CMS">CMS</a></span>

    <span style="font-size:15.6px"><a href="/search.html#!tag=The Installer">The Installer</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Android">Android</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Proxy">Proxy</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=HTTP">HTTP</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Git">Git</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Workflow">Workflow</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=Cache">Cache</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Block">Block</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=Module">Module</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Cart">Cart</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Customer">Customer</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Handle">Handle</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Events">Events</a></span>

    <span style="font-size:15.6px"><a href="/search.html#!tag=Attributes">Attributes</a></span>

    <span style="font-size:15.6px"><a href="/search.html#!tag=Product">Product</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Product type">Product type</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=EAV">EAV</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Thème">Thème</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=MariaDB">MariaDB</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=MySQL">MySQL</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Images">Images</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Aides de vue">Aides de vue</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=OS X">OS X</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Astuces">Astuces</a></span>

    <span style="font-size:14.4px"><a href="/search.html#!tag=MageConf">MageConf</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Émulation">Émulation</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Meet Magento">Meet Magento</a></span>

    <span style="font-size:13.2px"><a href="/search.html#!tag=Productivité">Productivité</a></span>

</p>

<hr />



</div>


<div id="contentWrap">

    


    <hr />
    <h2><a href="/connectez-vous-sur-un-compte-client-sur-magento.html">Se connecter sur le compte d'un client</a></h2>
    <div class="content post">
        <p>Par défaut sur la Magento Community, nous n'avons pas de fonctionnalité pour se connecter sur le compte du client.</p>

<p>Autant vous dire que parfois c'est quand même la <em>loose</em>. Bah ouais... le client a un problème et impossible de reproduire. De plus, lui demander de nous faire un screen pour voir comment ça se passe pour lui c'est juste... bah non en fait.</p>

<p>Alors la solution c'est de se connecter sur son compte, même si ça n'est pas toujours la solution miracle, souvent ça aide un peu.</p>

<p>Et puis on obtient d'un coup une autre fonctionnalité : on peut payer une commande pour le client par téléphone. Pratique non ?</p>

<!-- 




<hr />


<p>Le module que nous allons développer nous allons l'appeler <code>Jbh_ConnectAs</code> et il sera dans community.</p>

<p>Pourquoi dans community ? Parce qu'il est <a href="http://github.com/jacquesbh/jbh_connectas" title="Le module Jbh_ConnectAs sur GitHub">dispo en ligne</a>, pour la communauté.</p>

<h2>Posons les bases</h2>

<p>Nous avons besoin de :</p>

<ul>
<li>Un event pour ajouter le bouton « Connect As » sur la fiche client</li>
<li>Un observer qui va attraper l'event</li>
<li>Un contrôleur pour <em>se connecter sur le compte du client</em></li>
<li>Une gestion de droits pour ne pas afficher ce bouton à tout le monde</li>
</ul>


<p>Avec ça nous avons bien sûr besoin d'un <em>Helper Data</em>, mais d'aucun block.</p>

<h2>Notre event</h2>

<p>Quand on regarde bien on voit qu'on peut mettre des boutons au niveau du block <code>Mage_Adminhtml_Block_Customer_Edit</code>.
Après tout, pourquoi ne pourrions-nous pas avoir notre petit bouton orange à côté des autres ?</p>

<p>Ils utilisent dans le constructeur secondaire (<code>protected function _construct</code> sur tous les <code>Varien_Object</code>) la méthode <code>_addButton</code>. Pas de bol, elle est protégée... Pas super pratique pour nous ça. Pas grave, on regarde ce qu'elle fait... et là c'est le petit bonheur...</p>

<p>En fait il existe dans le container <code>Mage_Adminhtml_Block_Widget_Container</code> un alias public pour un certain nombre de méthodes protégées, dont notre <code>_addButton</code> :</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">addButton</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="nv">$level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sortOrder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$area</span> <span class="o">=</span> <span class="s1">&#39;header&#39;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_addButton</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="nv">$level</span><span class="p">,</span> <span class="nv">$sortOrder</span><span class="p">,</span> <span class="nv">$area</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>


<p>Donc si on réfléchi bien... il nous suffit de récupérer ce block avant qu'il n'affiche la fiche du client pour pouvoir y ajouter notre bouton dynamiquement.
On ne va pas se prendre la tête très longtemps sur l'évènement à attraper. Chaque action a un <code>event</code> qui annonce le début du rendu. Pour nous, c'est ça :</p>

<pre><code>controller_action_layout_render_before_adminhtml_customer_edit
</code></pre>

<p>Op, on a notre event :</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;controller_action_layout_render_before_adminhtml_customer_edit&gt;</span>
    <span class="nt">&lt;observers&gt;</span>
        <span class="nt">&lt;add_connectas_button&gt;</span>
            <span class="nt">&lt;class&gt;</span>jbh_connectas/observer<span class="nt">&lt;/class&gt;</span>
            <span class="nt">&lt;method&gt;</span>addOurCoolButton<span class="nt">&lt;/method&gt;</span>
        <span class="nt">&lt;/add_connectas_button&gt;</span>
    <span class="nt">&lt;/observers&gt;</span>
<span class="nt">&lt;/controller_action_layout_render_before_adminhtml_customer_edit&gt;</span>
</code></pre></div>


<p>Comme on le voit dans cet event l'observer sera <code>Jbh_ConnectAs_Model_Observer</code> et la méthode <code>addOurCoolButton</code>. Ce bout de xml sera à placer dans le tag <code>adminhtml</code> de notre <code>config.xml</code> car nous sommes sur un event lancé en partie admin.</p>

<h2>Les fichiers</h2>

<h3>La config : <code>/app/code/community/Jbh/ConnectAs/etc/config.xml</code></h3>

<script src="http://gist-it.appspot.com/github/jacquesbh/jbh_connectas/raw/master/app/code/community/Jbh/ConnectAs/etc/config.xml"></script>


<h3>Bien sûr notre fichier <em>etc/modules</em> : <code>/app/etc/modules/Jbh_ConnectAs.xml</code></h3>

<script src="http://gist-it.appspot.com/github/jacquesbh/jbh_connectas/raw/master/app/etc/modules/Jbh_ConnectAs.xml"></script>


<h3>Notre fichier pour les droits en admin : <code>/app/code/community/Jbh/ConnectAs/etc/adminhtml.xml</code></h3>

<script src="http://gist-it.appspot.com/github/jacquesbh/jbh_connectas/raw/master/app/code/community/Jbh/ConnectAs/etc/adminhtml.xml"></script>


<h3>Notre contrôleur d'admin : <code>/app/code/community/Jbh/ConnectAs/controllers/Adminhtml/IndexController.php</code></h3>

<script src="http://gist-it.appspot.com/github/jacquesbh/jbh_connectas/raw/master/app/code/community/Jbh/ConnectAs/controllers/Adminhtml/IndexController.php"></script>


<h3>Notre observeur : <code>/app/code/community/Jbh/ConnectAs/Model/Observer.php</code></h3>

<script src="http://gist-it.appspot.com/github/jacquesbh/jbh_connectas/raw/master/app/code/community/Jbh/ConnectAs/Model/Observer.php"></script>


<h3>Notre helper <code>Data</code> : <code>/app/code/community/Jbh/ConnectAs/Helper/Data.php</code></h3>

<script src="http://gist-it.appspot.com/github/jacquesbh/jbh_connectas/raw/master/app/code/community/Jbh/ConnectAs/Helper/Data.php"></script>


<h2>Et au final ça fonctionne comment ?</h2>

<p>A priori vous devriez voir apparaître au niveau des boutons d'actions de la fiche du client un nouveau bouton "Connect As".</p>

<p>N'oubliez pas que les droits sont gérés et que vous pouvez par conséquent autoriser certains rôles à utiliser cette fonctionnalité.</p>

<p>Il est également possible de rajouter des traductions puisque le PHP a été prévu pour. Il manque juste un peu de config et les fichiers CSV de traductions.</p>

<p>Merci à <a href="http://benjion.wordpress.com/2011/04/29/magento-se-connecter-en-tant-que-client-depuis-ladmin/">Benjion pour l'article original</a> que j'ai eu l'occasion d'améliorer/corriger.</p>

<p>Well done :)</p>

 -->





    </div>
    <div class="voirPlus">
        <div class="social">
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/connectez-vous-sur-un-compte-client-sur-magento.html" data-text="Se connecter sur le compte d'un client" data-via="jacquesbh">Tweet</a>
        </div>
        
        <a href="/connectez-vous-sur-un-compte-client-sur-magento.html#disqus_thread">Commentaires</a> -
        

        <a href="/connectez-vous-sur-un-compte-client-sur-magento.html">Lire la suite du tutoriel</a>

    </div>

    <hr />
    <h2><a href="/realisez-vos-propres-scripts-php-sur-magento.html">Les scripts Magento</a></h2>
    <div class="content post">
        <p>Nous sommes tous confrontés à un moment ou à un autre à devoir palier un problème rapidement sur un site en production.</p>

<p>Le problème le plus souvent doit se régler avec un script shell. Un script shell ok... mais en PHP !
Hors de question de se taper le script bash/python ou autre alors qu'on a besoin de charger Magento, d'accéder à la base etc.</p>

<p>Et surtout... il faut bien l'avouer, pouvoir accéder à la config, aux modèles et autres collections... bah c'est quand même bien pratique !</p>

<!-- 




<hr />


<p>Tout d'abord il faut déterminer un endroit où nous pouvons stocker nos scripts...</p>

<p>J'ai pour habitude de faire un répertoire <code>/misc</code>. Alors je vais la garder et c'est dans ce répertoire que nous allons créer nos fichiers.</p>

<pre><code>$ mkdir misc
$ vim misc/change_admin_password.php
</code></pre>

<p>Tant qu'à faire... autant réaliser un script pratique :)</p>

<p>On commence donc par charger Magento :</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>

<span class="c1">// Mage !</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/../app/Mage.php&#39;</span><span class="p">;</span>

<span class="c1">// Init Magento</span>
<span class="nx">Mage</span><span class="o">::</span><span class="na">app</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">);</span>

<span class="c1">// Init store (needed for save products for example)</span>
<span class="nx">Mage</span><span class="o">::</span><span class="na">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">setCurrentStore</span><span class="p">(</span><span class="nx">Mage_Core_Model_App</span><span class="o">::</span><span class="na">ADMIN_STORE_ID</span><span class="p">);</span>
</code></pre></div>


<p>Peut-être qu'avant ça il serait préférable de tester la validiter de notre ligne de commande ?</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>

<span class="c1">// Usage function :)</span>
<span class="k">function</span> <span class="nf">usage</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;Usage: php -f &quot;</span> <span class="o">.</span> <span class="nb">basename</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot; &lt;username&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">65</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Check command line</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">usage</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>


<p>Une fois qu'on a notre utilisateur, on le charge et on vérifie qu'il existe bien :</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>

<span class="c1">// We get the user</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">getModel</span><span class="p">(</span><span class="s1">&#39;admin/user&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;username&#39;</span><span class="p">);</span>

<span class="c1">// User exists?</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;Bad username.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="nx">usage</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>


<p>Ensuite on demande le mot de passe et on met à jour l'utilisateur :</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>

<span class="c1">// We ask for the password</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;Which password? &quot;</span><span class="p">;</span>
    <span class="nv">$password</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">));</span>
<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nv">$password</span><span class="p">);</span>

<span class="c1">// We change the user password :)</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setNewPassword</span><span class="p">(</span><span class="nv">$password</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

<span class="k">echo</span> <span class="s2">&quot;User updated</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</code></pre></div>


<p>On exécute :</p>

<pre><code>$ php misc/change_admin_password.php jacques
Which password? monSuperPassword      
User updated
$
</code></pre>

<hr />


<p>Voilà ce que ça donne :</p>

<script src="https://gist.github.com/3139595.js?file=misc-change_admin_password.php"></script>




<hr />


<p>Sauf qu'on a un problème... Là le script est super simple.</p>

<p>Et pour régler votre urgence vous avez besoin de vous mettre dans un environnement de "setup". En gros vous voulez être comme dans le fameux <code>mysql4-install-0.1.0.php</code> ;)</p>

<p>Pour récupérer un setup de l'EAV par exemple (pour pouvoir faire des <code>getAttributeId</code>) :</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="nv">$setup</span> <span class="o">=</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">getModel</span><span class="p">(</span><span class="s1">&#39;eav/entity_setup&#39;</span><span class="p">,</span> <span class="s1">&#39;eav&#39;</span><span class="p">);</span>

<span class="c1">// Op le SQL !</span>
<span class="c1">// $setup-&gt;run($sql);</span>
</code></pre></div>


<p>Pour récupérer une connection et une ressource :</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="nv">$res</span> <span class="o">=</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">getSingleton</span><span class="p">(</span><span class="s1">&#39;core/resource&#39;</span><span class="p">);</span>
<span class="nv">$cn</span> <span class="o">=</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">(</span><span class="s1">&#39;core_write&#39;</span><span class="p">);</span>

<span class="c1">// Nom d&#39;une table ?</span>
<span class="c1">// $res-&gt;getTableName(&#39;foo&#39;);</span>

<span class="c1">// Un select ? (Zend_Db_Select)</span>
<span class="c1">// $select = $cn-&gt;select();</span>
</code></pre></div>


<p>Voilà, à vous de jouer ! Et n'hésitez pas à partager vos scripts dans les commentaires, c'est toujours bon à prendre :)</p>

 -->





    </div>
    <div class="voirPlus">
        <div class="social">
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/realisez-vos-propres-scripts-php-sur-magento.html" data-text="Les scripts Magento" data-via="jacquesbh">Tweet</a>
        </div>
        
        <a href="/realisez-vos-propres-scripts-php-sur-magento.html#disqus_thread">Commentaires</a> -
        

        <a href="/realisez-vos-propres-scripts-php-sur-magento.html">Lire la suite du tutoriel</a>

    </div>

    <hr />
    <h2><a href="/creer-un-email-transactionnel-sur-magento.html">Les emails customs sur Magento</a></h2>
    <div class="content post">
        <p>Qui n'a pas voulu envoyer un email personnalisé rapidement via Magento ?</p>

<p>Les utilisations sont variées :</p>

<ul>
<li>Offrir un code promo à l'inscription</li>
<li>Informer le visiteur que son inscription à votre jeu concours est prise en compte</li>
<li>Annoncer au client que vous venez de lui offrir un produit pour sa prochaine commande car c'est son anniversaire</li>
<li>...</li>
</ul>


<p>Vous voulez faire ça ? Allez.. je vous aide :)</p>

<!-- 




<hr/>


<p>Le but de ce tutoriel est de vous montrer comment envoyer un email simplement depuis votre application.</p>

<p>Il s'agit d'envoyer un email transactionnel, pas une newsletter !</p>

<p>On va donc envoyer un email comprenant quelques informations sur le client (son nom par exemple) ainsi qu'un petit message.</p>

<h2>Le mail</h2>

<p>Sans trop se prendre la tête, voici le mail que nous voulons envoyer :</p>

<pre><code>Bonjour {name},

Aujourd'hui est un jour spécial.

Toute l'équipe de {nom de la boutique} vous souhaite un joyeux anniversaire !

A bientôt sur notre boutique,

L'équipe de {nom de la boutique}
</code></pre>

<p>En soit rien de compliqué, si ?</p>

<p>Nous utiliserons un email au format <em>texte</em>. Vous verrez qu'il ne sera pas bien compliqué de transformer ce mail dans une version colorée en HTML.</p>

<h3>C'est quoi son nom ?</h3>

<p>Pour bien comprendre le truc, il faut que nous donnions un nom à notre email.</p>

<p>On va donc prendre le nom de notre module (<em>Jbh_Demo</em>) et y ajouter le mot <em>email</em> avec à la fin le nom "réel" de notre email : <em>happyday</em>.</p>

<pre><code>    jbh_demo
             email
                   happyday
==&gt; jbh_demo/email/happyday
==&gt; jbh_demo_email_happyday
</code></pre>

<p>Ok... Mais l'identifiant qu'on vient de créer, il sert à quoi ?</p>

<p>Le premier c'est l'identifiant de la configuration qui permettra d'échanger l'email en dur (dans le fichier html) avec un email créé manuellement (via l'admin).</p>

<p>Le second c'est l'identifiant de notre email, en général.</p>

<h2>La config</h2>

<p>Editons notre fichier <code>/app/code/local/Jbh/Demo/etc/config.xml</code>.</p>

<script src="https://gist.github.com/3132212.js?file=app-code-local-Jbh-Demo-etc-config.xml"></script>


<p>Une partie <code>template</code> dans <code>global</code> consiste à indiquer à Magento que nous avons un nouvel email transactionnel dans l'application.</p>

<p>La partie <code>default</code> permet d'avoir en config l'identifiant de notre email. Vous remarquerez que la hiérarchie de la configuration par défaut suit parfaitement le schéma expliqué un peu plus haut : <code>jolie_demo &gt; email &gt; happyday</code>.</p>

<p>N'oubliez pas le fichier <code>/app/etc/modules/Jbh_Demo.xml</code> :)</p>

<script src="https://gist.github.com/3132212.js?file=app-etc-modules-Jbh_Demo.xml"></script>


<h2>Notre fichier email</h2>

<p>Editons notre fichier <code>/app/locale/fr_FR/template/email/jbh_demo/happyday.html</code> :</p>

<p>Nous avons besoin de respecter la syntaxe des emails sur Magento :</p>

<ul>
<li>Un titre avec la balise <code>&lt;!--@subject Jouyeux anniversaire ! @--&gt;</code></li>
<li>Un style optionnel avec la balise <code>&lt;!--@styles ... ici mon css ... @--&gt;</code></li>
<li>Un contenu avec ou sans variables</li>
</ul>


<p>Je vous laisse le soin de regarder les autres emails pour comprendre l'utilisation des variables. Ici nous feront juste en sorte que nos textes soient protégés.</p>

<script src="https://gist.github.com/3132212.js?file=app-locale-fr_FR-template-email-jbh_demo-happyday.html"></script>


<h2>Notre modèle</h2>

<p>Editons maintenant notre fichier <code>/app/code/local/Jbh/Demo/Model/Email.php</code> :</p>

<p>Il s'agit d'un simple modèle avec une méthode qui envoie un email au client passé en paramètre.</p>

<p>On notera la présence de deux constantes. Comme on le fait dans Magento, on utilise des constantes pour indiquer les chemins vers les variables de configuration. Ici nous avons les chemins vers le template et l'expéditeur du mail.</p>

<script src="https://gist.github.com/3132212.js?file=app-code-local-Jbh-Demo-Model-Email.php"></script>


<h2>Et ensuite ?</h2>

<p>Bah ensuite... il faut utiliser notre modèle !</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>

<span class="cm">/* @var $customer Mage_Customer_Model_Customer */</span>

<span class="nx">Mage</span><span class="o">::</span><span class="na">getSingleton</span><span class="p">(</span><span class="s1">&#39;jbh_demo/email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">happyday</span><span class="p">(</span><span class="nv">$customer</span><span class="p">);</span>
</code></pre></div>


<p>Voilà ! Vous savez maintenant créer des emails rapidement.
Rien de bien compliqué en fait !</p>

<p>Vous avez des questions ? Des remarques ? Les commentaires sont là pour ça.</p>

 -->



    </div>
    <div class="voirPlus">
        <div class="social">
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/creer-un-email-transactionnel-sur-magento.html" data-text="Les emails customs sur Magento" data-via="jacquesbh">Tweet</a>
        </div>
        
        <a href="/creer-un-email-transactionnel-sur-magento.html#disqus_thread">Commentaires</a> -
        

        <a href="/creer-un-email-transactionnel-sur-magento.html">Lire la suite du tutoriel</a>

    </div>

    <hr />
    <h2><a href="/un-slider-avec-le-jbhslider.html">Un slider avec le JbhSlider</a></h2>
    <div class="content post">
        <p>Il n'est pas rare de nos jours de voir un slider, le plus souvent en Javascript, sur une homepage, ou encore une fiche produit, etc.</p>

<p>Sauf que le développeur est confronté à un problème : L'intégrateur.
Non sans déconner... L'intégrateur il veut un balisage précis, et jamais le même que son collègue.</p>

<p>Et le développeur lui, il veut un truc pratique et il a pas envie de se prendre la tête, pour un slider.</p>

<!-- 




<hr/>


<p>On veut un slider pratique, mais c'est quasiment introuvable.</p>

<p>Quasiment, parce qu'en fait... j'en ai développé un rien que pour vous. Pour moi en fait.</p>

<p style="text-align:center;"><strong><a href="http://jacques.sh/jbhslider/" title="Simple way to slide">Le JbhSlider</a></strong></p>

<h2>Le HTML</h2>

<p>Plusieurs choix s'offrent à nous :</p>

<ul>
<li>Les <code>div</code> dans des <code>div</code> :</li>
</ul>


<div class="highlight"><pre><code class="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;mon_slider&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Slide 1<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>Slide 2<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>Slide 3<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>


<p style="text-align:center;">Exemple 1</p>

<ul>
<li>La liste à puces :</li>
</ul>


<div class="highlight"><pre><code class="html"><span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;mon_slider&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;</span>Slide 1<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span>Slide 2<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span>Slide 3<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div>


<p style="text-align:center;">Exemple 2</p>

<p>Par défaut nous sommes dans une liste à puce... entourée d'une <code>div</code> :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;mon_slider&quot;</span> <span class="na">style=</span><span class="s">&quot;margin: 0 auto;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
        <span class="nt">&lt;li&gt;&lt;img</span> <span class="na">src=</span><span class="s">&quot;http://placehold.it/250x125/26c877/ffffff&quot;</span> <span class="nt">/&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;&lt;img</span> <span class="na">src=</span><span class="s">&quot;http://placehold.it/250x125/d53221/ffffff&quot;</span> <span class="nt">/&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;&lt;img</span> <span class="na">src=</span><span class="s">&quot;http://placehold.it/250x125/47c8f3/ffffff&quot;</span> <span class="nt">/&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>


<p style="text-align:center;">Exemple 3</p>

<h2>Le Javascript</h2>

<p>Tout d'abord il nous faut inclure notre fichier slider javascript dans le <code>head</code> de notre page ou entre les balises <code>body</code> directement :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;jbhslider.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>


<p>Ensuite il suffit d'appeler ce petit bout de code pour activer notre exemple numéro 3.</p>

<div class="highlight"><pre><code class="javascript"><span class="c1">// La closure et le &quot;document ready&quot; ne sont pas toujours nécessaires</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#mon_slider&#39;</span><span class="p">).</span><span class="nx">jbhSlider</span><span class="p">({</span>
            <span class="c1">// Par défaut la taille est de 500 par 250</span>
            <span class="nx">css</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">width</span><span class="o">:</span> <span class="mi">250</span><span class="p">,</span>
                <span class="nx">height</span><span class="o">:</span> <span class="mi">125</span>
            <span class="p">},</span>
            <span class="c1">// Par défaut il y a une navigation précédent/suivant qui est générée</span>
            <span class="nx">navigation</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">active</span><span class="o">:</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>
</code></pre></div>




<hr/>




<div id="mon_slider" style="margin: 0 auto;">
    <ul>
        <li><img src="http://placehold.it/250x125/26c877/ffffff" /></li>
        <li><img src="http://placehold.it/250x125/d53221/ffffff" /></li>
        <li><img src="http://placehold.it/250x125/47c8f3/ffffff" /></li>
    </ul>
</div>




<script type="text/javascript" src="http://jacques.sh/jbhslider/js/jbh_slider.min.js"></script>


<script type="text/javascript">
// <![CDATA[
(function ($) {
    $(document).ready(function () {
        $('#mon_slider').jbhSlider({
            css: {
                width: 250,
                height: 125
            },
            navigation: {
                active: false
            }
        });
    });
})(jQuery);
// ]]>
</script>




<hr />


<p>Je vous invite vraiment à aller lire la <a href="http://jacques.sh/jbhslider/#documentation" title="Une documentation complète">documentation du slider</a> !</p>

 -->





    </div>
    <div class="voirPlus">
        <div class="social">
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/un-slider-avec-le-jbhslider.html" data-text="Un slider avec le JbhSlider" data-via="jacquesbh">Tweet</a>
        </div>
        
        <a href="/un-slider-avec-le-jbhslider.html#disqus_thread">Commentaires</a> -
        

        <a href="/un-slider-avec-le-jbhslider.html">Lire la suite du tutoriel</a>

    </div>

    <hr />
    <h2><a href="/quelques-snippets-magento.html">Quelques snippets Magento</a></h2>
    <div class="content post">
        <p>Quand on développe sur Magento on est amené à taper certaines syntaxes un nombre incalculable de fois...</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">echo</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">helper</span><span class="p">(</span><span class="s1">&#39;core/string&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">truncate</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>
</code></pre></div>


<p>Vous voyez ce que je veux dire ?</p>

<!-- 




<hr />


<p>Il existe beaucoup d'outils pour mettre en place des snippets.</p>

<p>La plupart des IDE (Netbeans, PhpStorm, ...) et même les plus gros éditeurs (comme Vim) permettent l'utilisation de snippets. Via des plugins ou non.</p>

<p>Le but de cet article n'est pas de vous expliquer comment fonctionnent les snippets, mais bien de vous en donner un petit nombre.</p>

<h2>Pour Vim (avec <a href="http://www.vim.org/scripts/script.php?script_id=2540" title="TextMate-style snippets for Vim ">SnipMate</a>)</h2>

<script src="https://gist.github.com/2987266.js?file=php.snippets"></script>


<h2>Pour Netbeans</h2>

<script src="https://gist.github.com/2987266.js?file=netbeans_magento_snippets.xml"></script>


<h2>Pour PhpStorm</h2>

<p>Merci à <a href="http://jacques.sh/quelques-snippets-magento.html#comment-598945986">Laurent</a> pour son gist !</p>

<script src="https://gist.github.com/3184638.js?file=PHP.xml"></script>




 -->





    </div>
    <div class="voirPlus">
        <div class="social">
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/quelques-snippets-magento.html" data-text="Quelques snippets Magento" data-via="jacquesbh">Tweet</a>
        </div>
        
        <a href="/quelques-snippets-magento.html#disqus_thread">Commentaires</a> -
        

        <a href="/quelques-snippets-magento.html">Lire l'article</a>

    </div>


<div class="pagination">
    <hr/>
    
    
    
    <a href="/page5" class="previous">Précédent</a>
    
    –
    
    
    <span class="page_number">Page 6 sur 7</span>
    
    
    –
    <a href="/page7" class="next">Suivant</a>
    
    
</div>



</div>

<script type="text/javascript">
    var disqus_shortname = 'jacquesbh';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



    </div>

    <div id="bottomWrap">
        <div id="contactWrap">
            <form action="#" method="post" id="contact_form">
                <h3>Contact</h3>
                <p>
                    <label for="contactNom">Votre nom</label>
                    <input type="text" name="contact_name" id="contact_name" class="text" tabindex="1" />
                </p>
                <p>
                    <label for="contactEmail">Votre email</label>
                    <input type="email" name="contact_email" id="contact_email" class="text" tabindex="2" />
                </p>
                <p>
                    <label for="contactMessage">Message</label>
                    <textarea name="contact_message" id="contact_message" rows="5" cols="30" tabindex="8"></textarea>
                </p>
                <p class="send">
                    <input type="hidden" name="redirect_to" value="http://jacques.sh/contact/thanks.html" />
                    <input type="submit" id="contactSend" value="Envoyer" tabindex="9" />
                </p>
                <div style="display: none;" class="url">http://getsimpleform.com/messages?form_api_token=4ba030c3b67553e1ccb25710aee63bd6</div>
            </form>
            <div class="qrcode">
                <h3>Mon QRcode</h3>
                <p>
                    <img src="/img/qrcode.png" alt="le QRcode" width="198" height="192" />
                </p>
            </div>
        </div>

        <div id="footerWrap">
            <div class="social">
                <a href="https://twitter.com/jacquesbh" class="twitter-follow-button" data-show-count="false">Follow @jacquesbh</a>
            </div>
            
            <a href="http://monsieurbiz.com" title="Découvrez Monsieur Biz, une agence spécialisée sur Magento, solution e-commerce">Agence Magento</a>
            | 

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <a href="/credits.html">Crédits</a>
        
    

    
        
    

    
        
    

    
        
            |
            <a href="/legals.html">Informations légales</a>
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    





            | <a href="/atom.xml">RSS</a>
            | <a href="#" id="toplink">Haut de page</a>
            <br />
            <span class="copy">&copy; Jacques Bodin-Hullin - 2013</span>
        </div>
    </div>

</div>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-27192340-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>





<script type="text/javascript" src="/js/jquery/cookies.js"></script>
    <div id="popin" class="monsieurbiz-popin" style="display: none;">
        <img src="/img/monsieurbiz.png" alt="" height="250" style="height: 250px;" />
        <h2><span class="lines">Un projet, Une agence</span></h2>
        <div class="action">
            <p>
                Monsieur Biz, une agence spécialisée Magento pour votre projet.
            </p>
            <a href="http://monsieurbiz.com">
                <div class="button1">C'est par ici que ça se passe !</div>
            </a>
        </div>
    </div>

    <script type="text/javascript">
    if (typeof disable_popin === 'undefined' || !disable_popin) {
        (function ($) {
            $(document).ready(function () {
                var cookieId = 'monsieurbizPopinDisplayed';
                if ($.cookie(cookieId) == null) {
                    $.fancybox.open('#popin');
                    $.cookie(cookieId, 'true');
                }
            });
         })(jQuery);
    }
    </script>


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</body>
</html>

