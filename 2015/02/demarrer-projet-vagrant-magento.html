

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <title>Comment utiliser Vagrant et Magento ? - Jacques Bodin-Hullin, développeur Magento</title>
    <meta name="description" content="Apprenez votre projet Magento avec la box Vagrant de Monsieur Biz !">
    <meta name="keywords" content="vagrant magento">
    <meta name="author" content="Jacques Bodin-Hullin">
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/js/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
    <link rel="alternate" type="application/rss+xml" title="Jacques Bodin-Hullin - Latest Posts" href="/atom.xml" >

    <script type="text/javascript" src="/js/jquery-1.10.2.min.js" ></script>
    <script type="text/javascript" src="/js/bootstrap.min.js" ></script>
    <script type="text/javascript" src="/js/fancybox/jquery.fancybox.pack.js" ></script>
    <script type="text/javascript" src="/js/event.js" ></script>
    <script type="text/javascript" src="/js/functions.js" ></script>

    <style for="gists"></style>
</head>
<body class="">

<div id="mainWrap">

    <div id="topWrap">
        <div id="headerWrap">
            <p>
                Jacques Bodin-Hullin
                <span class="baseline">Développeur d'applications Web</span>
            </p>
            <a href="http://jacques.sh"></a>

            <div id="magento_certified">
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="L'Agence Monsieur Biz est certifiée Magento Solution Specialist" class="solution-specialist" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="L'Agence Monsieur Biz est certifiée Magento Developer Plus" class="developer-plus" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin, développeur certifié Magento Developer" class="developer" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin est développeur certifié Magento Front End Developer" class="frontend-developer" target="_blank"></a>
            </div>



        </div>

        <blockquote id="quoteWrap">
            
            <p>
                La perfection est atteinte non quand il ne reste rien à ajouter, mais quand il ne reste
                rien à enlever.
            </p>
            <div><cite>Antoine de Saint Exupéry</cite></div>
            
        </blockquote>

        <div class="menu-wrapper">
            <ul id="menu">
                
                <li><a href="/"><span></span>Accueil</a></li>
                
                <li><a href="https://github.com/jacquesbh" target="_blank"><span></span>Code</a></li>
                
                
    
        
    

    
        
            
            <li><a href="/a-propos.html"><span></span>A propos</a></li>
            
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    




                <li class="search">
                    <form action="/search.html" method="get" id="search_form">
                        <div>
                            <input type="text" name="q" placeholder="Votre recherche" />
                        </div>
                    </form>
                </li>
            </ul>
        </div>

        <div class="mbiz">
            <p>
                <a href="http://monsieurbiz.com" title="Découvrez l'agence Monsieur Biz, spécialiste Magento">
                    <img src="/img/monsieurbiz_bg.png" title="L'Agence Monsieur Biz" />
                    <span>Vous cherchez une agence spécialiste du e-commerce certifiée Magento Solution Specialist ? L'agence Monsieur Biz est faite pour vous !</span>
                </a>
            </p>
        </div>
    </div>

    <div id="globalWrap">


    

    <div id="contentWrap" class="post">

        <h1>Comment utiliser Vagrant et Magento ?</h1>

        <p>Ça fait plusieurs fois qu'on me demande comment on utilise Vagrant chez <a href="http://monsieurbiz.com">Monsieur Biz</a>.</p>

<p>J'ai donc décidé de faire un article malgré le peu de temps que j'ai à ma disposition en ce moment.</p>

<p>L'idée c'est de vous montrer comment on fonctionne.
Après libre à vous de nous faire quelques PR sur Github, ou encore de ne pas utiliser notre box, tout simplement !</p>

<p>Je vous expliquerai aussi pourquoi nous ne passons pas sur Docker pour le moment.</p>

<p>Pour les plus impatients, vous trouverez la <a href="https://github.com/monsieurbiz/vagrant-magento">Vagrant Box Magento de Monsieur Biz sur Github</a>.</p>

<!-- more start -->


<hr />

<p>Pour ceux qui ne sont pas habitués à Vagrant, sachez que ça n'est pas très compliqué.<br/>
Par ailleurs je vais essayer de donner un maximum d'explications.</p>

<p><em>NB : Je suis exclusivement sur Mac. Donc il est très très fort probable que la box ne fonctionne pas pour vous si vous êtes sur Windows ou Linux.</em></p>

<h2>Le Vagrantfile</h2>

<p>Ce fichier est le point de départ de votre Vagrant. Je vais tenter d'expliquer celui que j'ai réalisé.</p>

<script src="http://gist-it.appspot.com/https://github.com/monsieurbiz/vagrant-magento/blob/master/Vagrantfile"></script>


<p>Au tout début il s'agit de quelques commentaires pour dire à Vim d'utiliser la syntax de ruby.<br/>
Ensuite vient le nom d'hôte de votre projet, ici <code>vagrant-mage.dev</code>. On utilise <code>.dev</code> car ça permet d'éviter la résolution des DNS.
Juste en dessous on a l'IP utilisée pour Virtualbox. Si vous utilisez Virtualbox, faites en sorte ici d'avoir une IP différente pour chacun de vos projets.</p>

<p>Bon ensuite viennent les deux lignes qui permettent de rentrer dans la configuration de la box à proprement parler :</p>

<pre><code>VAGRANTFILE_API_VERSION = "2"
Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
</code></pre>

<p>Là on entre simplement dans la configuration, comme l'indique bien le <code>Vagrant.configure</code>.</p>

<p>Au tout début on a la configuration pour VMWare :</p>

<ul>
<li>On sélectionne précisément la box qu'on veut télécharger (elle ne l'est qu'une seule fois) ;</li>
<li>On précise la puissance de la VM ;</li>
<li>On ajoute une seconde interface ethernet. L'idée ici c'est d'avoir une seconde adresse IP dispo sur VM sur le même sous-réseau que la machine hôte. On utilise cette interface pour tester nos sites sur des machines virtuelles Windows.</li>
</ul>


<p>Ensuite il y a une configuration pour Virtual Box :</p>

<ul>
<li>Même chose on précise la box qu'on veut utiliser ;</li>
<li>On améliore un peu les perfs de Virtual Box ;</li>
<li>On assigne l'adresse IP qui est en haut du fichier.</li>
</ul>


<p><strong>Pourquoi choisir VM Ware et pas Virtual Box ?</strong></p>

<blockquote><p>Je suis parti du constat que Virtual Box est lent. La copie des fichiers, si ça n'est pas en NFS, est basée sur la solution native de Virtual Box : une horreur.<br/>
Finalement au bout de quelques mois j'ai tout simplement testé VMWare. Il s'avère que ma machine de dev basée sur Vagrant et VMWare est tout aussi rapide, voire plus rapide, que les serveurs de prod. Donc je n'ai pas cherché plus longtemps, le choix était fait.</p></blockquote>

<p>Ensuite on a un peu de configuration réseau. Et surtout l'assignation du hostname à la ligne <code>config.vm.hostname</code>.</p>

<p>Le plus important c'est les dossiers partagés. On utilise NFS afin de gagner en performances (c'est "juste" ce qu'on utilise entre les serveurs pour partager des dossiers…).<br/>
<a href="https://github.com/IvanChepurnyi">Ivan Chepurnyi</a> et moi-même nous sommes amusés fin 2013 lors d'un Hackathon à Leipzig en Allemagne à améliorer les performances de NFS. C'est pour cette raison qu'on y trouve plein de trucs étranges du genre :</p>

<pre><code>mount_options: ["nolock", "async"],
bsd__nfs_options: ["alldirs","async","nolock"]
</code></pre>

<p>À noter que les options <code>bsd__nfs_options</code> sont dédiées à OSX (et à BSD du coup…) ;</p>

<p>Les lignes suivantes permettent de modifier le fichier <code>/etc/hosts</code> de votre machine afin de ne pas s'embêter avec l'IP auto-assignée par VMWare à la machine virtuelle :</p>

<pre><code># "Provision" with hostmanager
config.vm.provision :hostmanager
</code></pre>

<p>Ensuite on initialise la Vagrant avec Puppet !</p>

<p>On y retrouve quelques paramètres de personnalisation. Les voici expliqués avec des commentaires :</p>

<script>gist('jacquesbh/cab7770ec953e653379d', 'factors.rb');</script>


<p>Le dernier truc sympa c'est ça :</p>

<script>gist('jacquesbh/cab7770ec953e653379d', 'localfile.rb');</script>


<p>Ici c'est très simple. Si vous avez un fichier <code>LocalVagrantfile.rb</code> à la racine de votre projet (au même endroit que le <code>Vagrantfile</code> et bien celui-ci sera chargé.<br/>
Ça permet d'avoir un fichier dédié à votre projet, ou un fichier juste pour vous.<br/>
Personnellement ce fichier est dans mon <code>~/.gitignore</code>. Ainsi je peux ajouter des interfaces réseau, faire un peu de custom, etc. et ça uniquement pour moi !</p>

<h2>Et sinon, elle contient quoi ta Vagrant ?</h2>

<p>La box contient plein de choses !</p>

<p>Entre autres :</p>

<ul>
<li><a href="https://github.com/jacquesbh/installer">L'Installer pour Magento (<em>a PHP command line tool for Magento extension development and scaffolding</em>)</a> accessible par défaut ;</li>
<li><a href="https://github.com/netz98/n98-magerun">Magerun</a> ;</li>
<li><a href="https://github.com/colinmollenhour/modman">Modman</a> ;</li>
<li>Deux certificats SSL : <code>*.vagrant-mage.dev</code> et <code>[www.]vagrant-mage.dev</code> (car ici le hostname est sur <code>vagrant-mage.dev</code> mais si vous le changez alors les certificats seront adaptés par Puppet) ;</li>
<li>Du coup 3 <code>VirtualHost</code> sur Apache qui gèrent les domaines suivants en <code>http</code> et <code>https</code> : <code>*.vagrant-mage.dev</code> et <code>vagrant-mage.dev</code>. C'est super pratique si vous voulez tester votre projet avec un SSL. Surtout que maintenant c'est une bonne pratique d'être full SSL.</li>
<li>Mailcatcher : Afin qu'aucun email ne se disperse dans l'Internet Mondial hein. Pour le lancer c'est simple : <code>mailcatcher --ip=0.0.0.0</code>.</li>
<li>Quelques outils : <code>git</code>, <code>tmux</code> (avec <a href="https://gist.github.com/jacquesbh/9187257">config perso</a>), <code>screen</code> (avec <a href="https://github.com/jacquesbh/dotfiles/blob/master/.screenrc">config perso</a>, <code>htop</code> et <code>vim</code>.</li>
<li><a href="http://casperjs.org/">CasperJS</a>, et donc du coup <a href="http://phantomjs.org/">PhantomJS</a>.</li>
<li><a href="https://getcomposer.org/">Composer</a></li>
<li><a href="https://phpunit.de/">PHPUnit</a></li>
<li>MySQL évidemment. Du coup si vous avez un fichier <code>database.sql.gz</code> à la racine de votre projet (avec votre <code>Vagrantfile</code>) alors il sera importé au premier lancement.</li>
</ul>


<h2>Installer hostmanager</h2>

<p><code>hostmanager</code> est un petit plugin vagrant qui permet de modifier votre fichier <code>/etc/hosts</code> comme je l'indique un peu plus haut dans l'article. Pour l'installer :</p>

<pre><code>vagrant plugin install vagrant-hostmanager
</code></pre>

<h2>Comment démarrer un projet avec la Vagrant Box Magento ?</h2>

<p>Commencez par cloner le projet où vous voulez : <code>git clone https://github.com/monsieurbiz/vagrant-magento.git</code></p>

<p>Ensuite créez le dossier de votre projet et copiez-y les fichiers et dossiers <code>Vagrantfile</code> et <code>puppet/</code>.<br/>
Le dossier <code>htdocs/</code> doit exister également, c'est dans celui-ci que vous mettrez votre projet Magento.</p>

<p>C'est parti pour un <code>vagrant up</code> !</p>

<p>Là ça va tout installer et tout et tout…</p>

<p>Ensuite rendez-vous dans votre navigateur sur <code>http://vagrant-mage.dev</code> ou <code>https://vagrant-mage.dev</code>.</p>

<p>Pensez à aller en SSH dans votre dossier Magento : <code>vagrant ssh</code> puis <code>cd /vagrant/htdocs</code>.<br/>
Là vous pouvez lancer <code>magerun</code> par exemple ! Ou encore <code>installer</code> !</p>

<h2>C'est fini !</h2>

<p>J'ai rédigé cet article très très rapidement, alors si vous avez des remarques ou questions, n'hésitez pas !</p>

<p>:)</p>

<!-- more end -->





        <hr />

        
        <h2 id="comments">Commentaires</h2>
        


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jacquesbh'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




        
    </div>

    <div id="sideWrap">

    <h2>Quelques infos</h2>
    <ul class="infos">
        <li>
            <span>Par</span>
            <strong>Jacques Bodin-Hullin</strong>
            
        </li>
        <li>
            <span>Publié le</span>
            <strong>04 February 2015</strong>
        </li>
        <li>
            <span>Les tags</span>
            <strong>
                
                <a href="/search.html#!tag=Vagrant">Vagrant</a>, 
                
                <a href="/search.html#!tag=Magento">Magento</a>
                
            </strong>
        </li>
        
        
    </ul>

    <div class="social">
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/2015/02/demarrer-projet-vagrant-magento.html" data-text="Comment utiliser Vagrant et Magento ?" data-via="jacquesbh">Tweet</a>
    </div>

    
</div>


    </div>

    <div id="bottomWrap">
        <div id="contactWrap">
            <form action="#" method="post" id="contact_form">
                <h3>Contact</h3>
                <p>
                    <label for="contactNom">Votre nom</label>
                    <input type="text" name="contact_name" id="contact_name" class="text" tabindex="1" />
                </p>
                <p>
                    <label for="contactEmail">Votre email</label>
                    <input type="email" name="contact_email" id="contact_email" class="text" tabindex="2" />
                </p>
                <p>
                    <label for="contactMessage">Message</label>
                    <textarea name="contact_message" id="contact_message" rows="5" cols="30" tabindex="8"></textarea>
                </p>
                <p class="send">
                    <input type="hidden" name="redirect_to" value="http://jacques.sh/contact/thanks.html" />
                    <input type="submit" id="contactSend" value="Envoyer" tabindex="9" />
                </p>
                <div style="display: none;" class="url">http://getsimpleform.com/messages?form_api_token=4ba030c3b67553e1ccb25710aee63bd6</div>
            </form>
            <div class="qrcode">
                <h3>Mon QRcode</h3>
                <p>
                    <img src="/img/qrcode.png" alt="le QRcode" width="198" height="192" />
                </p>
            </div>
        </div>

        <div id="footerWrap">
            <div class="social">
                <a href="https://twitter.com/jacquesbh" class="twitter-follow-button" data-show-count="false">Follow @jacquesbh</a>
            </div>
            
            <a href="http://monsieurbiz.com" title="Découvrez Monsieur Biz, une agence spécialisée sur Magento, solution e-commerce">Agence Magento</a>
            | 

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <a href="/credits.html">Crédits</a>
        
    

    
        
    

    
        
    

    
        
            |
            <a href="/legals.html">Informations légales</a>
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    





            | <a href="/atom.xml">RSS</a>
            | <a href="#" id="toplink">Haut de page</a>
            <br />
            <span class="copy">&copy; Jacques Bodin-Hullin - 2014</span>
        </div>
    </div>

</div>




  <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-27192340-2', 'auto');
  ga('send', 'pageview');

</script>






<script type="text/javascript" src="/js/jquery/cookies.js"></script>
    <div id="popin" class="monsieurbiz-popin" style="display: none;">
        <img src="/img/monsieurbiz.png" alt="" height="250" style="height: 250px;" />
        <h2><span class="lines">Un projet, Une agence</span></h2>
        <div class="action">
            <p>
                Monsieur Biz, une agence spécialisée Magento pour votre projet.
            </p>
            <a href="http://monsieurbiz.com">
                <div class="button1">C'est par ici que ça se passe !</div>
            </a>
        </div>
    </div>

    <script type="text/javascript">
    if (typeof disable_popin === 'undefined' || !disable_popin) {
        (function ($) {
            $(document).ready(function () {
                var cookieId = 'monsieurbizPopinDisplayed';
                if ($.cookie(cookieId) == null) {
                    $.fancybox.open('#popin');
                    $.cookie(cookieId, 'true', { expires: 15 });
                }
            });
         })(jQuery);
    }
    </script>


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</body>
</html>

