

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <title>Installation de votre SSL + Top sécurité - Jacques Bodin-Hullin, développeur Magento</title>
    <meta name="description" content="Maintenant que vous avez un certificat SSL, il vous faut l'installer ! Je vous propose de vous montrer comment le faire sur Apache et ainsi avoir une note A+ en sécurité.">
    <meta name="keywords" content="sslapachesecurite">
    <meta name="author" content="Jacques Bodin-Hullin">
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/js/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
    <link rel="alternate" type="application/rss+xml" title="Jacques Bodin-Hullin - Latest Posts" href="/atom.xml" >

    <script type="text/javascript" src="/js/jquery-1.10.2.min.js" ></script>
    <script type="text/javascript" src="/js/bootstrap.min.js" ></script>
    <script type="text/javascript" src="/js/fancybox/jquery.fancybox.pack.js" ></script>
    <script type="text/javascript" src="/js/event.js" ></script>
    <script type="text/javascript" src="/js/functions.js" ></script>

    <style for="gists"></style>
</head>
<body class="">

<div id="mainWrap">

    <div id="topWrap">
        <div id="headerWrap">
            <p>
                Jacques Bodin-Hullin
                <span class="baseline">Développeur d'applications Web</span>
            </p>
            <a href="http://jacques.sh"></a>

            <div id="magento_certified">
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="L'Agence Monsieur Biz est certifiée Magento Solution Specialist" class="solution-specialist" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="L'Agence Monsieur Biz est certifiée Magento Developer Plus" class="developer-plus" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin, développeur certifié Magento Developer" class="developer" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin est développeur certifié Magento Front End Developer" class="frontend-developer" target="_blank"></a>
            </div>



        </div>

        <blockquote id="quoteWrap">
            
            <p>
                La perfection est atteinte non quand il ne reste rien à ajouter, mais quand il ne reste
                rien à enlever.
            </p>
            <div><cite>Antoine de Saint Exupéry</cite></div>
            
        </blockquote>

        <div class="menu-wrapper">
            <ul id="menu">
                
                <li><a href="/"><span></span>Accueil</a></li>
                
                <li><a href="https://github.com/jacquesbh" target="_blank"><span></span>Code</a></li>
                
                
    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <li><a href="/a-propos"><span></span>A propos</a></li>
            
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    




                <li class="search">
                    <form action="/search.html" method="get" id="search_form">
                        <div>
                            <input type="text" name="q" placeholder="Votre recherche" />
                        </div>
                    </form>
                </li>
            </ul>
        </div>

        <div class="mbiz">
            <p>
                <a href="http://monsieurbiz.com" title="Découvrez l'agence Monsieur Biz, spécialiste Magento">
                    <img src="/img/monsieurbiz_bg.png" title="L'Agence Monsieur Biz" />
                    <span>Vous cherchez une agence spécialiste du e-commerce certifiée Magento Solution Specialist ? L'agence Monsieur Biz est faite pour vous !</span>
                </a>
            </p>
        </div>
    </div>

    <div id="globalWrap">


    

    <div id="contentWrap" class="post">

        <h1>Installation de votre SSL + Top sécurité</h1>

        <div class="carrousel">
    <img src="/images/posts/installer-certificat-ssl-apache/ssl-security--grade-a.png" width="608" />
</div>


<p>Maintenant que vous avez acheté <a href="http://jacques.sh/2014/08/certificat-ssl-business.html">votre certificat SSL Business</a> et que vous êtes prêt à l'installer sur votre serveur, voici quelques astuces pour obtenir la qualité optimale au niveau sécurité et ainsi éviter que votre site ne s'affiche pas sur certains navigateurs (Android etc.) à cause d'une alerte de sécurité !</p>

<!-- more start -->


<hr />

<h3>Les ingrédients</h3>

<p>Pour réaliser cette recette il vous faudra :</p>

<ol>
<li>La clé de votre certificat : <code>jacques.sh.key</code> ;</li>
<li>Votre certificat : <code>jacques.sh.crt</code> ;</li>
<li>Le bundle de votre certificat : <code>jacques.sh.bundle</code>.</li>
</ol>


<p>Le premier ingrédient est facile à trouver puisque vous l'avez généré vous-même en même temps que votre <code>Certificate Signing Request</code> (<code>CSR</code>).</p>

<p>Le second, le certificat, vous est délivré par une <a href="http://jacques.sh/2014/08/certificat-ssl-business.html">autorité de certification telle que gandi</a> par exemple (là où vous l'avez acheté tout simplement).</p>

<p>La dernier est plus difficile à avoir. Voici comment faire.</p>

<h3>Le bon bundle</h3>

<p>Le bundle c'est votre chaîne de certification. C'est tout simplement un fichier qui contient les certificats de la chaine les uns en dessous des autres.<br/>
La chaine de certification commence par votre certificat et se termine par un certicat root. Par contre le bundle ne contient ni votre certificat ni le certificat root mais seulements ceux qui sont intermédiaires.
C'est pour cette raison que ces certificats sont aussi appelés des « intermédiaires » car c'est tout simplement leur rôle.</p>

<p>En général il y a 3 ou 4 certificats (en comptant le vôtre et le root) dans la chaîne (<a href="https://www.sslshopper.com/ssl-checker.html#hostname=google.com" target="_blank">exemple avec google</a>).</p>

<p>Le problème c'est d'avoir les bons intermédiaires pour avoir le bon bundle !</p>

<p>Prenons l'exemple d'un certificat Business COMODO chiffré avec l'algorithme SHA2 :</p>

<ol>
<li><code>jacques.sh.crt</code> : c'est le vôtre ;</li>
<li><code>COMODOExtendedValidationSecureServerCA2.pem</code> : c'est le dernier intermédiaire ;</li>
<li><code>COMODORSAAddTrustCA.crt</code> : c'est le second intermédiaire. Il est signé par un <code>root certificate</code> ;</li>
<li><code>AddTrust External CA Root.cer</code> : c'est le certificat root. Il est auto-signé et dans le « Trust Store », donc il ne lèvera pas d'exception de sécurité.</li>
</ol>


<p>Au passage, les seuls certificats auto-signés qui sont acceptés par défaut par votre navigateur sont ceux qui sont dans le Trust Store.</p>

<p>Et dans le bundle on met quoi alors ? Et bien on prend les intermédiaires et on les concatène dans leur priorité croissante : le plus proche de votre certificat en premier.</p>

<pre><code>-----BEGIN CERTIFICATE-----
[...]o/Br0Oksxgn
KKlHMd99SUW[...]
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
[...]bCBDQSBSb29
sHNA7qxcS1u[...]
-----END CERTIFICATE-----
</code></pre>

<p>De <code>-----BEGIN CERTIFICATE-----</code> à <code>-----END CERTIFICATE-----</code> c'est un certificat. Le premier est donc le contenu de <code>COMODOExtendedValidationSecureServerCA2.pem</code> et le second le contenu de <code>COMODORSAAddTrustCA.crt</code>.</p>

<p>On a notre <code>jacques.sh.bundle</code> !</p>

<p>Le problème c'est : <strong>comment on sait qu'on ne s'est pas trompé ?</strong></p>

<p>Un certificat est signé par un autre, sauf le root qui est auto-signé. Donc si on veut le « papa » d'un certificat, que ça soit un intermédiaire ou le certifiat final, il nous faut savoir qui l'a émis.<br/>
Pour ça on ouvre le certificat et on trouve le <code>Common name</code> du <code>Issuer</code>. En gros on veut le nom du certificat parent.</p>

<p>Voici un exemple avec un intermédiaire COMODO (présicément celui de notre exemple, le <code>COMODORSAAddTrustCA.crt</code>) :</p>

<p class="center">
    <img src="/images/posts/installer-certificat-ssl-apache/intermediate.png" width="608" />
</p>


<p>Le papa c'est donc <code>AddTrust External CA Root</code>. Oh bah tiens, c'est le root !</p>

<p>Une fois votre certificat installé sur votre serveur avec son bundle, pensez à vérifier que tout est bon ici : <a href="https://www.sslshopper.com/ssl-checker.html">https://www.sslshopper.com/ssl-checker.html</a><br/>
Ce site vous dira si votre chaîne n'est pas bonne.</p>

<p>On dit souvent qu'on a pas besoin d'inclure les intermédiaires. Mais il s'avère que certains navigateurs (surtout sur mobile) ne font pas de recherche pour trouver les certificats intermédiaires pour vous. Il faut les fournir !</p>

<p><em>Note : votre certificat doit être chiffré avec l'algorithme SHA2 car le SHA1 est en fin de vie. Par conséquent le SHA2 n'étant pas géré par tous les navigateurs à l'heure où j'écris ces lignes, il est possible que vous soyez obligé d'ajouter un intermédiaire "cross-signed" dans votre bundle. Plus d'infos ici sur les intermédiaires ici : <a href="http://wiki.gandi.net/fr/ssl/intermediate">http://wiki.gandi.net/fr/ssl/intermediate</a></em></p>

<h3>Installation sur Apache</h3>

<p>Là c'est super simple, il vous suffit de reproduire ça dans votre VirtualHost en changeant les chemins !</p>

<p>Évidemment n'oubliez pas de copier les fichiers sur votre serveur !</p>

<pre><code>&lt;IfModule mod_ssl.c&gt;
    # Activate SSL
    SSLEngine on

    # Certificates
    SSLCertificateFile /etc/ssl/certs/jacques.sh/jacques.sh.crt
    SSLCertificateKeyFile /etc/ssl/certs/jacques.sh/jacques.sh.key
    SSLCertificateChainFile /etc/ssl/certs/jacques.sh/jacques.sh.bundle
&lt;/IfModule&gt;
</code></pre>

<p>Et la sécurité dans tout ça ? Là on a notre certificat mais ça ne nous donne pas une note A+ sur <a href="https://www.ssllabs.com/ssltest/analyze.html">SSL Labs</a> !</p>

<p>On va ajouter quelques petits détails sous nos certificats :</p>

<pre><code># Security
SSLCipherSuite AES128+EECDH:AES128+EDH
SSLProtocol All -SSLv2 -SSLv3
SSLHonorCipherOrder On
Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains"
Header always set X-Frame-Options DENY
Header always set X-Content-Type-Options nosniff

# More security - Requires Apache &gt;= 2.4
SSLCompression off 
SSLUseStapling on 
SSLStaplingCache "shmcb:logs/stapling-cache(150000)"
</code></pre>

<p>Attention à la partie qui ne concerne que Apache >= 2.4 !</p>

<p>On a donc ceci dans notre VirtualHost :</p>

<pre><code>&lt;IfModule mod_ssl.c&gt;
    # Activate SSL
    SSLEngine on

    # Certificates
    SSLCertificateFile /etc/ssl/certs/jacques.sh/jacques.sh.crt
    SSLCertificateKeyFile /etc/ssl/certs/jacques.sh/jacques.sh.key
    SSLCertificateChainFile /etc/ssl/certs/jacques.sh/jacques.sh.bundle

    # Security
    SSLCipherSuite AES128+EECDH:AES128+EDH
    SSLProtocol All -SSLv2 -SSLv3
    SSLHonorCipherOrder On
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains"
    Header always set X-Frame-Options DENY
    Header always set X-Content-Type-Options nosniff

    # More security - Requires Apache &gt;= 2.4
    SSLCompression off 
    SSLUseStapling on 
    SSLStaplingCache "shmcb:logs/stapling-cache(150000)"
&lt;/IfModule&gt;
</code></pre>

<p>Vous trouverez plus d'infos sur la partie <a href="https://cipherli.st/">sécurité sur Cipherli.st</a> pour Apache/Nginx/Lighttpd/haproxy…</p>

<p>Avec la <code>CipherSuite</code> ci dessus certains navigateurs comme IE8 sur Windows XP ne pourront pas afficher votre site. C'est un choix qui n'est pas anodin.
Vous pouvez utiliser le <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/">générateur de configuration SSL proposé par Mozilla</a> pour avoir quelque chose qui vous convienne.</p>

<p>N'oublier pas de lancer un petit <code>apache2ctl -t</code> avant de recharger la configuration.</p>

<p>Et en dernier, <a href="https://www.ssllabs.com/ssltest/analyze.html">testez votre site sur ssllabs</a> !</p>

<!-- more end -->





        <hr />

        
        <h2 id="comments">Commentaires</h2>
        


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_shortname = 'jacquesbh'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




        
    </div>

    <div id="sideWrap">

    <h2>Quelques infos</h2>
    <ul class="infos">
        <li>
            <span>Par</span>
            <strong>Jacques Bodin-Hullin</strong>
            
        </li>
        <li>
            <span>Publié le</span>
            <strong>14 February 2015</strong>
        </li>
        <li>
            <span>Les tags</span>
            <strong>
                
                <a href="/search.html#!tag=SSL">SSL</a>, 
                
                <a href="/search.html#!tag=Apache">Apache</a>, 
                
                <a href="/search.html#!tag=Sécurité">Sécurité</a>
                
            </strong>
        </li>
        
        
    </ul>

    <div class="social">
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/2015/02/installer-certificat-ssl-apache.html" data-text="Installation de votre SSL + Top sécurité" data-via="jacquesbh">Tweet</a>
    </div>

    
</div>


    </div>

    <div id="bottomWrap">
        <div id="contactWrap">
            <form action="#" method="post" id="contact_form">
                <h3>Contact</h3>
                <p>
                    <label for="contactNom">Votre nom</label>
                    <input type="text" name="contact_name" id="contact_name" class="text" tabindex="1" />
                </p>
                <p>
                    <label for="contactEmail">Votre email</label>
                    <input type="email" name="contact_email" id="contact_email" class="text" tabindex="2" />
                </p>
                <p>
                    <label for="contactMessage">Message</label>
                    <textarea name="contact_message" id="contact_message" rows="5" cols="30" tabindex="8"></textarea>
                </p>
                <p class="send">
                    <input type="hidden" name="redirect_to" value="http://jacques.sh/contact/thanks.html" />
                    <input type="submit" id="contactSend" value="Envoyer" tabindex="9" />
                </p>
                <div style="display: none;" class="url">http://getsimpleform.com/messages?form_api_token=4ba030c3b67553e1ccb25710aee63bd6</div>
            </form>
            <div class="qrcode">
                <h3>Mon QRcode</h3>
                <p>
                    <img src="/img/qrcode.png" alt="le QRcode" width="198" height="192" />
                </p>
            </div>
        </div>

        <div id="footerWrap">
            <div class="social">
                <a href="https://twitter.com/jacquesbh" class="twitter-follow-button" data-show-count="false">Follow @jacquesbh</a>
            </div>
            
            <a href="http://monsieurbiz.com" title="Découvrez Monsieur Biz, une agence spécialisée sur Magento, solution e-commerce">Agence Magento</a>
            | 

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <a href="/credits">Crédits</a>
        
    

    
        
    

    
        
    

    
        
            |
            <a href="/legals">Informations légales</a>
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    





            | <a href="/atom.xml">RSS</a>
            | <a href="#" id="toplink">Haut de page</a>
            <br />
            <span class="copy">&copy; Jacques Bodin-Hullin - 2014</span>
        </div>
    </div>

</div>




  <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-27192340-2', 'auto');
  ga('send', 'pageview');

</script>






<script type="text/javascript" src="/js/jquery/cookies.js"></script>
    <div id="popin" class="monsieurbiz-popin" style="display: none;">
        <img src="/img/monsieurbiz.png" alt="" height="250" style="height: 250px;" />
        <h2><span class="lines">Un projet, Une agence</span></h2>
        <div class="action">
            <p>
                Monsieur Biz, une agence spécialisée Magento pour votre projet.
            </p>
            <a href="http://monsieurbiz.com">
                <div class="button1">C'est par ici que ça se passe !</div>
            </a>
        </div>
    </div>

    <script type="text/javascript">
    if (typeof disable_popin === 'undefined' || !disable_popin) {
        (function ($) {
            $(document).ready(function () {
                var cookieId = 'monsieurbizPopinDisplayed';
                if ($.cookie(cookieId) == null) {
                    $.fancybox.open('#popin');
                    $.cookie(cookieId, 'true', { expires: 15 });
                }
            });
         })(jQuery);
    }
    </script>


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</body>
</html>

