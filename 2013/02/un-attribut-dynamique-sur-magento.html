

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <title>Un attribut dynamique - Jacques Bodin-Hullin, développeur Magento</title>
    <meta name="description" content="Il est temps de ne pas perdre de temps avec les attributs à valeur multiple !">
    <meta name="keywords" content="eav, magento, attribute">
    <meta name="author" content="Jacques Bodin-Hullin">
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/js/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
    <link rel="alternate" type="application/rss+xml" title="Jacques Bodin-Hullin - Latest Posts" href="/atom.xml" >

    <script type="text/javascript" src="/js/jquery-1.10.2.min.js" ></script>
    <script type="text/javascript" src="/js/fancybox/jquery.fancybox.pack.js" ></script>
    <script type="text/javascript" src="/js/event.js" ></script>
    <script type="text/javascript" src="/js/functions.js" ></script>

    <style for="gists"></style>
</head>
<body class="">

<div id="mainWrap">

    <div id="topWrap">
        <div id="headerWrap">
            <p>
                Jacques Bodin-Hullin
                <span class="baseline">Développeur d'applications Web</span>
            </p>
            <a href="http://jacques.sh"></a>

            <div id="magento_certified">
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin, développeur certifié Magento Developer" class="developer" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="L'Agence Monsieur Biz est certifiée Magento Developer Plus" class="developer-plus" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin est développeur certifié Magento Front End Developer" class="frontend-developer" target="_blank"></a>
            </div>

        </div>

        <blockquote id="quoteWrap">
            
            <p>
                La perfection est atteinte non quand il ne reste rien à ajouter, mais quand il ne reste
                rien à enlever.
            </p>
            <div><cite>Antoine de Saint Exupéry</cite></div>
            
        </blockquote>

        <ul id="menu">
            
            <li><a href="/"><span></span>Accueil</a></li>
            
            <li><a href="https://github.com/jacquesbh" target="_blank"><span></span>Code</a></li>
            
            
    
        
    

    
        
            
            <li><a href="/a-propos.html"><span></span>A propos</a></li>
            
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <li><a href="/references.html"><span></span>Références</a></li>
            
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    




            <li class="search">
                <form action="/search.html" method="get" id="search_form">
                    <div>
                        <input type="text" name="q" placeholder="Votre recherche" />
                    </div>
                </form>
            </li>
        </ul>

        <div class="mbiz">
            <p>
                <a href="http://monsieurbiz.com" title="Découvrez l'agence Monsieur Biz, spécialiste Magento">
                    <img src="/img/monsieurbiz_bg.png" title="L'Agence Monsieur Biz" />
                    <span>Vous cherchez une agence à taille humaine spécialisée sur la solution e-commerce Magento ? L'agence Monsieur Biz est faite pour vous.</span>
                </a>
            </p>
        </div>
    </div>

    <div id="globalWrap">


    

    <div id="contentWrap" class="post">

        <h1>Un attribut dynamique</h1>

        <p>Parfois il est nécessaire de faire des développements un peu <em>borderline</em>...</p>

<p>Aujourd'hui je vais vous expliquer comment j'ai réalisé un petit module afin de permettre d'ajouter une valeur à un attribut de type <code>select</code> ou <code>multiselect</code>... <strong>sans quitter la page d'édition du produit</strong> <em>(ou de la catégorie)</em>. Directement depuis le champ de l'attribut.</p>

<p>Sur Magento on peut avoir un <em>Backend Model</em> sur un attribut, dans le but de valider son contenu, ou encore de faire des manipulations avant et/ou après sa sauvegarde/récupération. Je vais profiter de cette fonctionnalité !</p>

<p>Il s'avère qu'on peut aussi avoir un champ HTML personnalisé en admin très facilement.</p>

<p>Au final c'est pas bien compliqué et le module <code>Jbh_DynamicField</code> est réutilisable ;)</p>

<p>Je vous explique ?</p>

<p><strong>Let's go! Borderline!</strong></p>

<!-- more start -->


<hr />

<p>Pour commencer je vous explique ce que fait ce champ dynamique :</p>

<p><img src="/images/posts/un-attribut-dynamique-sur-magento/dynamic-field.png" title="Le champ dynamique" alt="&quot;Le champ dynamique&quot;" /></p>

<p>L'idée c'est que si vous remplissez le champ <em>Nouvelle valeur</em> alors la valeur entrée sera ajoutée aux options possibles pour l'attribut concerné.<br/>
Quand le champ est de type <code>select</code> alors l'option sera en plus assignée à l'attribut. Si c'est un attribut <code>multiselect</code> alors l'option sera ajoutée aux options déjà sélectionnées.</p>

<p>Il faut noter qu'un évènement est lancé lorsqu'une option est ajoutée. C'est très pratique quand on veut effectuer une action lors de l'ajout d'une option.<br/>
Par contre attention ! Aucun évènement n'est lancé quand une option est ajoutée via l'administration des attributs !</p>

<h2>Un champ HTML personnalisé</h2>

<p>Magento permet, via la colonne <code>frontend_input_renderer</code>, de la table <code>catalog_eav_attribut</code>, de changer le <code>renderer</code> (le block qui fait le rendu HTML) de l'attribut dans les formulaire où celui-ci est utilisé.</p>

<p>J'ai donc ajouté deux nouveaux blocks :</p>

<ol>
<li><code>Jbh_DynamicField_Block_Adminhtml_Catalog_Product_Renderer_Select</code> pour gérer les attributs de type <code>select</code>.</li>
<li><code>Jbh_DynamicField_Block_Adminhtml_Catalog_Product_Renderer_Multiselect</code> pour gérer les attributs de type <code>multiselect</code>.</li>
</ol>


<p>Ces deux blocks sont simples. Ils ajoutent un champ nommé <code>jbh_dynamicfield_CODE</code> dans notre formulaire, avec <code>CODE</code> qui est le code de l'attribut.</p>

<p>Voici le block <code>Jbh_DynamicField_Block_Adminhtml_Catalog_Product_Renderer_Select</code> :</p>

<script src="http://gist-it.appspot.com/github/jacquesbh/Jbh_DynamicField/raw/master/app/code/community/Jbh/DynamicField/Block/Adminhtml/Catalog/Product/Renderer/Select.php"></script>


<p>Le block <code>Jbh_DynamicField_Block_Adminhtml_Catalog_Product_Renderer_Multiselect</code> est identique au niveau de la méthode <code>getElementHtml</code> mais les deux blocks n'étendent pas la même classe. Les traits de PHP seraient ici une bonne alternative à ce copier/coller.</p>

<h2>Une sauvegarde améliorée</h2>

<p>Cette fois c'est dans la table <code>eav_attribute</code> et via la colonne <code>backend_model</code> que Magento nous permet de modifier la sauvegarde (et/ou le chargement) de notre attribut.</p>

<p>J'ai donc logiquement créé deux nouveaux modèles :</p>

<ol>
<li><code>Jbh_DynamicField_Model_Catalog_Product_Attribute_Backend_Select</code> pour gérer les attributs de type <code>select</code>.</li>
<li><code>Jbh_DynamicField_Model_Catalog_Product_Attribute_Backend_Multiselect</code> pour gérer les attributs de type <code>multiselect</code>.</li>
</ol>


<p>Des deux modèles permettent d'ajouter une option à notre attribut si le champ supplémentaire ajouté par le <code>renderer</code> contient quelque chose.</p>

<p>L'idée c'est donc de récupérer le code de l'attribut, puis le nom du champ supplémentaire.<br/>
Ensuite on effectue une vérification simple pour savoir s'il contient quelque chose.<br/>
Si c'est le cas alors on ajoute la nouvelle option. <em>Aucune déduplication n'est effectuée ici.</em><br/>
Un évènement est lancé si une option a été ajoutée.</p>

<p>Et en dernier on sauvegarde la nouvelle option dans notre objet.</p>

<p>Rien de mieux pour bien comprendre qu'un exemple.<br/>
Voici le modèle qui gère les <code>multiselect</code> :</p>

<script src="http://gist-it.appspot.com/github/jacquesbh/Jbh_DynamicField/raw/master/app/code/community/Jbh/DynamicField/Model/Catalog/Product/Attribute/Backend/Multiselect.php"></script>


<p>De manière générale les deux modèles font la même chose.</p>

<p>La différence se situe tout d'abord dans le modèle parent. Le <em>select</em> étend le modèle <code>abstract</code> alors que le <em>multiselect</em> le <code>array</code>.<br/>
Ensuite la manière dont la valeur est changée quand une option a été ajoutée change aussi un peu, surtout au niveau du <em>multiselect</em>.</p>

<p>Notez que l'évènement lancé, dans le cas où une option est ajoutée, est le suivant :</p>

<ul>
<li>Nom : <code>jbh_dynamicfield_attribute_CODE_option_added</code> où <code>CODE</code> est le code de l'attribut principal.</li>
<li>Données :

<ul>
<li><code>object</code> : Votre produit/catégorie.</li>
<li><code>code</code> : Le code de votre attribute. (que vous connaissez puisque vous utilisez un event qui porte son nom !) Il est là afin de permettre des actions dynamiques.</li>
<li><code>option</code> : Un tableau qui contient l'identifiant de la nouvelle option et sa valeur textuelle. Respectivement les clés <code>id</code> et <code>value</code>.</li>
</ul>
</li>
</ul>


<h2>Borderline ?</h2>

<p>Au final je n'ai pas expliqué pourquoi un tel développement est, selon moi, un peu bordeline.</p>

<p>Tout d'abord il n'y a aucune gestion des stores et donc de la possible traduction de l'option.<br/>
L'ajout d'une nouvelle option implique la sauvegarde du produit ou de la catégorie afin d'être prise en compte... On aurait préféré avoir un peu d'ajax afin d'ajouter plusieurs options en même temps !<br/>
Il n'y a aucune gestion des problèmes de duplication d'options qu'un tel système engendre.</p>

<p>Ce développement est vraiment pratique mais il est important que les personnes qui manipulent l'administration soient formées sur le fonctionnement de ce système.</p>

<p>Si vous souhaitez <a href="https://github.com/jacquesbh/Jbh_DynamicField">améliorer le module <code>Jbh_DynamicField</code> : c'est sur github !</a>.</p>

<!-- more end -->





        <hr />

        
        <h2 id="comments">Commentaires</h2>
        


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jacquesbh'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




        
    </div>

    <div id="sideWrap">

    <h2>Quelques infos</h2>
    <ul class="infos">
        <li>
            <span>Par</span>
            <strong>Jacques Bodin-Hullin</strong>
            
        </li>
        <li>
            <span>Publié le</span>
            <strong>17 February 2013</strong>
        </li>
        <li>
            <span>Les tags</span>
            <strong>
                
                <a href="/search.html#!tag=Magento">Magento</a>, 
                
                <a href="/search.html#!tag=Attributes">Attributes</a>, 
                
                <a href="/search.html#!tag=Product">Product</a>, 
                
                <a href="/search.html#!tag=EAV">EAV</a>, 
                
                <a href="/search.html#!tag=Module">Module</a>
                
            </strong>
        </li>
        
        <li>
            <span>Dépôt GitHub</span>
            <strong><a href="https://github.com/jacquesbh/Jbh_DynamicField">jacquesbh/Jbh_DynamicField</a></strong>
        </li>
        
        
    </ul>

    <div class="social">
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/2013/02/un-attribut-dynamique-sur-magento.html" data-text="Un attribut dynamique" data-via="jacquesbh">Tweet</a>
    </div>

    
</div>


    </div>

    <div id="bottomWrap">
        <div id="contactWrap">
            <form action="#" method="post" id="contact_form">
                <h3>Contact</h3>
                <p>
                    <label for="contactNom">Votre nom</label>
                    <input type="text" name="contact_name" id="contact_name" class="text" tabindex="1" />
                </p>
                <p>
                    <label for="contactEmail">Votre email</label>
                    <input type="email" name="contact_email" id="contact_email" class="text" tabindex="2" />
                </p>
                <p>
                    <label for="contactMessage">Message</label>
                    <textarea name="contact_message" id="contact_message" rows="5" cols="30" tabindex="8"></textarea>
                </p>
                <p class="send">
                    <input type="hidden" name="redirect_to" value="http://jacques.sh/contact/thanks.html" />
                    <input type="submit" id="contactSend" value="Envoyer" tabindex="9" />
                </p>
                <div style="display: none;" class="url">http://getsimpleform.com/messages?form_api_token=4ba030c3b67553e1ccb25710aee63bd6</div>
            </form>
            <div class="qrcode">
                <h3>Mon QRcode</h3>
                <p>
                    <img src="/img/qrcode.png" alt="le QRcode" width="198" height="192" />
                </p>
            </div>
        </div>

        <div id="footerWrap">
            <div class="social">
                <a href="https://twitter.com/jacquesbh" class="twitter-follow-button" data-show-count="false">Follow @jacquesbh</a>
            </div>
            
            <a href="http://monsieurbiz.com" title="Découvrez Monsieur Biz, une agence spécialisée sur Magento, solution e-commerce">Agence Magento</a>
            | 

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <a href="/credits.html">Crédits</a>
        
    

    
        
    

    
        
            |
            <a href="/legals.html">Informations légales</a>
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    





            | <a href="/atom.xml">RSS</a>
            | <a href="#" id="toplink">Haut de page</a>
            <br />
            <span class="copy">&copy; Jacques Bodin-Hullin - 2013</span>
        </div>
    </div>

</div>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-27192340-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>





<script type="text/javascript" src="/js/jquery/cookies.js"></script>
    <div id="popin" class="monsieurbiz-popin" style="display: none;">
        <img src="/img/monsieurbiz.png" alt="" height="250" style="height: 250px;" />
        <h2><span class="lines">Un projet, Une agence</span></h2>
        <div class="action">
            <p>
                Monsieur Biz, une agence spécialisée Magento pour votre projet.
            </p>
            <a href="http://monsieurbiz.com">
                <div class="button1">C'est par ici que ça se passe !</div>
            </a>
        </div>
    </div>

    <script type="text/javascript">
        (function ($) {
            $(document).ready(function () {
                var cookieId = 'monsieurbizPopinDisplayed';
                if ($.cookie(cookieId) == null) {
                    $.fancybox.open('#popin');
                    $.cookie(cookieId, 'true');
                }
            });
         })(jQuery);
    </script>


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</body>
</html>

