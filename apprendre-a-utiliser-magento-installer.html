

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <title>Utiliser l'Installer - Créer un grid en admin - Jacques Bodin-Hullin, développeur Magento</title>
    <meta name="description" content="L'Installer est très pratique et permet de gagner un temps fou ! Apprenez à l'utiliser.">
    <meta name="keywords" content="magento, installer">
    <meta name="author" content="Jacques Bodin-Hullin">
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/js/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
    <link rel="alternate" type="application/rss+xml" title="Jacques Bodin-Hullin - Latest Posts" href="/atom.xml" >

    <script type="text/javascript" src="/js/jquery-1.10.2.min.js" ></script>
    <script type="text/javascript" src="/js/fancybox/jquery.fancybox.pack.js" ></script>
    <script type="text/javascript" src="/js/event.js" ></script>
    <script type="text/javascript" src="/js/functions.js" ></script>

    <style for="gists"></style>
</head>
<body class="">

<div id="mainWrap">

    <div id="topWrap">
        <div id="headerWrap">
            <p>
                Jacques Bodin-Hullin
                <span class="baseline">Développeur d'applications Web</span>
            </p>
            <a href="http://jacques.sh"></a>

            <div id="magento_certified">
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin, développeur certifié Magento Developer" class="developer" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="L'Agence Monsieur Biz est certifiée Magento Developer Plus" class="developer-plus" target="_blank"></a>
                <a href="http://www.magentocommerce.com/certification/directory/dev/69536/" title="Jacques Bodin-Hullin est développeur certifié Magento Front End Developer" class="frontend-developer" target="_blank"></a>
            </div>

        </div>

        <blockquote id="quoteWrap">
            
            <p>
                La perfection est atteinte non quand il ne reste rien à ajouter, mais quand il ne reste
                rien à enlever.
            </p>
            <div><cite>Antoine de Saint Exupéry</cite></div>
            
        </blockquote>

        <ul id="menu">
            
            <li><a href="/"><span></span>Accueil</a></li>
            
            <li><a href="https://github.com/jacquesbh" target="_blank"><span></span>Code</a></li>
            
            
    
        
    

    
        
            
            <li><a href="/a-propos.html"><span></span>A propos</a></li>
            
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <li><a href="/references.html"><span></span>Références</a></li>
            
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    




            <li class="search">
                <form action="/search.html" method="get" id="search_form">
                    <div>
                        <input type="text" name="q" placeholder="Votre recherche" />
                    </div>
                </form>
            </li>
        </ul>

        <div class="mbiz">
            <p>
                <a href="http://monsieurbiz.com" title="Découvrez l'agence Monsieur Biz, spécialiste Magento">
                    <img src="/img/monsieurbiz_bg.png" title="L'Agence Monsieur Biz" />
                    <span>Vous cherchez une agence à taille humaine spécialisée sur la solution e-commerce Magento ? L'agence Monsieur Biz est faite pour vous.</span>
                </a>
            </p>
        </div>
    </div>

    <div id="globalWrap">


    

    <div id="contentWrap" class="post">

        <h1>Utiliser l'Installer - Créer un grid en admin</h1>

        <p>Dans mon article précédent je dévoile mon <strong>Installer</strong>.</p>

<p>Pour vous permettre de prendre en main et vous montrer les possibilités de l'outil je vais vous montrer comment faire un simple grid en admin, en 13mn et 30s.</p>

<p>A vos marques...</p>

<!-- more start -->




<hr />


<p>Ce tutoriel utilise l'<strong>Installer</strong> : <a href="http://jacques.sh/the-installer-v1.html">En savoir plus sur l'Installer pour Magento</a></p>

<p>Tout d'abord on commence par déterminer ce dont nous avons besoin :</p>

<ol>
<li>Un module <code>Jbh_Grid</code></li>
<li>Un modèle <code>Foo</code>, une ressource <code>Foo</code> et une collection <code>Foo_Collection</code></li>
<li>Un routeur admin et son menu</li>
<li>Un contrôleur admin</li>
<li>2 blocs pour constituer le grid en admin (le container et le grid)</li>
<li>Un setup MySQL</li>
<li>Un helper Data pour les traductions, ainsi qu'un fichier de traductions <code>.csv</code></li>
</ol>


<p>Nous ne verrons pas ici comment faire le formulaire pour ajouter/éditer notre objet <code>Foo</code>.</p>

<h2>Création des fichiers grâce à l'Installer</h2>

<p>Lançons l'outil : (<a href="https://github.com/jacquesbh/Installer/tree/v1#bash-function-required">Voir le README</a>)</p>

<pre><code>$ jbh
The Installer - by jacquesbh
&gt;
</code></pre>

<p>On commence par créer notre module :</p>

<pre><code>&gt; mod jbh grid local
Using: Jbh_Grid in local
Jbh_Grid&gt;
</code></pre>

<p>Notez qu'on peut lancer l'Installer directement sur le module que l'on souhaite :</p>

<pre><code>$ jbh jbh grid local
The Installer - by jacquesbh
Using: Jbh_Grid in local
&gt;
</code></pre>

<p>Ensuite passons à notre "entité" :</p>

<pre><code>Jbh_Grid&gt; ent foo jbh_grid_foo
</code></pre>

<p>Vous pouvez bien sûr ne taper que <code>ent</code> ou <code>entity</code> et suivre les instructions :</p>

<pre><code>Jbh_Grid&gt; entity
Entity?
&gt; foo
Table?
&gt; jbh_grid_foo
</code></pre>

<p>A ce stade nous avons tous nos modèles.</p>

<p>Le routeur en admin :</p>

<pre><code>Jbh_Grid&gt; r admin foo_adminhtml
</code></pre>

<p>Pour le menu il nous faudra éditer manuellement le fichier <code>etc/adminhtml.xml</code> de notre module.</p>

<p>(N'y oublions pas les ACL ;))</p>

<p>Ensuite il nous faut notre contrôleur admin avec l'action grid :</p>

<pre><code>Jbh_Grid&gt; c adminhtml_index grid
</code></pre>

<p>Nous en sommes à l'étape où il nous faut créer le grid...</p>

<p>2 possibilités :</p>

<ul>
<li>Soit : créer le grid bloc après bloc, initialiser les blocs etc.</li>
<li>Soit : utiliser la commande grid qui fait (presque) tout à notre place</li>
</ul>


<p>Le choix est vite fait...</p>

<pre><code>Jbh_Grid&gt; grid foo
</code></pre>

<p>Il nous faut le setup pour créer notre table en base de données !</p>

<pre><code>Jbh_Grid&gt; setup
</code></pre>

<p>On termine par notre Helper Data : (vide)</p>

<pre><code>Jbh_Grid&gt; h data -
</code></pre>

<h2>Résumé des commandes</h2>

<p>Une fois que vous connaissez les commandes (alias + ordre des arguments) vous pouvez aller vraiment vite !</p>

<p>Vraiment vite... On reprend, en 30 secondes :</p>

<pre><code>$ jbh jbh grid local
The Installer - by jacquesbh
Using: Jbh_Grid in local
Jbh_Grid&gt; ent foo jbh_grid_foo
Jbh_Grid&gt; r admin foo_adminhtml
Jbh_Grid&gt; c adminhtml_index grid
Jbh_Grid&gt; grid foo
Jbh_Grid&gt; setup
Jbh_Grid&gt; h data -
Jbh_Grid&gt;
</code></pre>

<h2>Le SQL de notre table</h2>

<p>Réfléchissons 3 minutes pour construire notre table en base de données :</p>

<div class="highlight"><pre><code class="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">jbh_grid_foo</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">foo_id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">&#39;The Foo ID&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="nb">text</span><span class="o">`</span> <span class="nb">text</span> <span class="k">COMMENT</span> <span class="s1">&#39;The text of our Foo&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">created_at</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;Creation date&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">updated_at</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;Update date&#39;</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">foo_id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</code></pre></div>


<p>Complétons notre setup :</p>

<script src="https://gist.github.com/3344499.js?file=app/code/local/Jbh/Grid/sql/jbh_grid_setup/mysql4-install-0.1.0.php"></script>


<h2>Notre menu admin</h2>

<p>Il nous faut éditer notre fichier <code>etc/adminhtml.xml</code> pour ajouter notre menu et les ACLs :</p>

<script src="https://gist.github.com/3344499.js?file=app/code/local/Jbh/Grid/etc/adminhtml.xml"></script>


<h2>Notre contrôleur admin</h2>

<p>On ajoute avant tout la méthode <code>_isAllowed()</code> à notre contrôleur :</p>

<pre><code>Jbh_Grid&gt; c adminhtml_index _isAllowed:bool
</code></pre>

<p>On complète assez rapidement !</p>

<script src="https://gist.github.com/3344499.js?file=app/code/local/Jbh/Grid/controllers/Adminhtml/IndexController.php"></script>


<h2>Complétons notre grid</h2>

<p>Il nous faut ajouter les colonnes à notre grid ainsi que le configurer un minimum...</p>

<h3>Le container</h3>

<script src="https://gist.github.com/3344499.js?file=app/code/local/Jbh/Grid/Block/Adminhtml/Foo.php"></script>


<h3>Le grid</h3>

<script src="https://gist.github.com/3344499.js?file=app/code/local/Jbh/Grid/Block/Adminhtml/Foo/Grid.php"></script>


<h2>N'oublions pas les traductions !</h2>

<pre><code>Jbh_Grid&gt; __
Where? (enter for front)
&gt; admin
Translate?
&gt; Foo #
Traduction for fr_FR?
&gt; Foo ID
Traduction for en_US?
&gt; 
Jbh_Grid&gt; __
Translate?
&gt; Text
Traduction for fr_FR?
&gt; Texte
Traduction for en_US?
&gt; 
Jbh_Grid&gt; __
Translate?
&gt; Manage Foos
Traduction for fr_FR?
&gt; Gérer les Foos
Traduction for en_US?
&gt; 
Jbh_Grid&gt;
</code></pre>

<p>Vous aurez remarqué que lors de l'ajout de la première ligne dans les fichiers de traduction l'Installer nous demande où nous voulons ajouter nos traductions. Tout simplement parce que la manipulation des traductions implique l'ajout d'un bout de config à notre module.</p>

<p>Et ça donne ça, pour le français par exemple :</p>

<script src="https://gist.github.com/3344499.js?file=app/locales/fr_FR/Jbh_Grid.csv"></script>


<h2>Conclusion</h2>

<p>Au final...</p>

<ul>
<li>30 secondes pour créer notre architecture</li>
<li>3 minutes pour créer le SQL et compléter le setup</li>
<li>5 minutes pour le fichier <code>adminhtml.xml</code></li>
<li>5 minutes pour terminer le grid</li>
</ul>


<p>Ce qu'on obtient : Un module propre, développé avec les conventions <code>Zend Framework</code>, sans erreur de config.</p>

<p>Surtout... le <code>config.xm</code>l... <code>&lt;3 &lt;3 &lt;3</code></p>

<script src="https://gist.github.com/3344499.js?file=app/code/local/Jbh/Grid/etc/config.xml"></script>


<p>Le bonheur quoi...</p>

<p>Vos avis sont les bienvenus !</p>

<p>Vous pouvez <a href="https://gist.github.com/3344499/download">télécharger ce module</a>.</p>

<h3>Astuce</h3>

<p>Pour avoir une licence personnalisée dans le haut de mes fichiers voici la commande que j'ai réellement lancée :</p>

<pre><code>$ LICENSE='WTFPL (http://sam.zoy.org/wtfpl/COPYING)' jbh jbh grid local
</code></pre>

<!-- more end -->





        <hr />

        
        <h2 id="comments">Commentaires</h2>
        


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jacquesbh'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




        
    </div>

    <div id="sideWrap">

    <h2>Quelques infos</h2>
    <ul class="infos">
        <li>
            <span>Par</span>
            <strong>Jacques Bodin-Hullin</strong>
            
        </li>
        <li>
            <span>Publié le</span>
            <strong>14 August 2012</strong>
        </li>
        <li>
            <span>Les tags</span>
            <strong>
                
                <a href="/search.html#!tag=Magento">Magento</a>, 
                
                <a href="/search.html#!tag=The Installer">The Installer</a>
                
            </strong>
        </li>
        
        
        <li>
            <span>Gist associé</span>
            <strong><a href="https://gist.github.com/3344499">3344499</a></strong>
        </li>
        
    </ul>

    <div class="social">
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jacques.sh/apprendre-a-utiliser-magento-installer.html" data-text="Utiliser l'Installer - Créer un grid en admin" data-via="jacquesbh">Tweet</a>
    </div>

    
</div>


    </div>

    <div id="bottomWrap">
        <div id="contactWrap">
            <form action="#" method="post" id="contact_form">
                <h3>Contact</h3>
                <p>
                    <label for="contactNom">Votre nom</label>
                    <input type="text" name="contact_name" id="contact_name" class="text" tabindex="1" />
                </p>
                <p>
                    <label for="contactEmail">Votre email</label>
                    <input type="email" name="contact_email" id="contact_email" class="text" tabindex="2" />
                </p>
                <p>
                    <label for="contactMessage">Message</label>
                    <textarea name="contact_message" id="contact_message" rows="5" cols="30" tabindex="8"></textarea>
                </p>
                <p class="send">
                    <input type="hidden" name="redirect_to" value="http://jacques.sh/contact/thanks.html" />
                    <input type="submit" id="contactSend" value="Envoyer" tabindex="9" />
                </p>
                <div style="display: none;" class="url">http://getsimpleform.com/messages?form_api_token=4ba030c3b67553e1ccb25710aee63bd6</div>
            </form>
            <div class="qrcode">
                <h3>Mon QRcode</h3>
                <p>
                    <img src="/img/qrcode.png" alt="le QRcode" width="198" height="192" />
                </p>
            </div>
        </div>

        <div id="footerWrap">
            <div class="social">
                <a href="https://twitter.com/jacquesbh" class="twitter-follow-button" data-show-count="false">Follow @jacquesbh</a>
            </div>
            
            <a href="http://monsieurbiz.com" title="Découvrez Monsieur Biz, une agence spécialisée sur Magento, solution e-commerce">Agence Magento</a>
            | 

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
            
            <a href="/credits.html">Crédits</a>
        
    

    
        
    

    
        
            |
            <a href="/legals.html">Informations légales</a>
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    

    
        
    





            | <a href="/atom.xml">RSS</a>
            | <a href="#" id="toplink">Haut de page</a>
            <br />
            <span class="copy">&copy; Jacques Bodin-Hullin - 2013</span>
        </div>
    </div>

</div>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-27192340-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>





<script type="text/javascript" src="/js/jquery/cookies.js"></script>
    <div id="popin" class="monsieurbiz-popin" style="display: none;">
        <img src="/img/monsieurbiz.png" alt="" height="250" style="height: 250px;" />
        <h2><span class="lines">Un projet, Une agence</span></h2>
        <div class="action">
            <p>
                Monsieur Biz, une agence spécialisée Magento pour votre projet.
            </p>
            <a href="http://monsieurbiz.com">
                <div class="button1">C'est par ici que ça se passe !</div>
            </a>
        </div>
    </div>

    <script type="text/javascript">
        (function ($) {
            $(document).ready(function () {
                var cookieId = 'monsieurbizPopinDisplayed';
                if ($.cookie(cookieId) == null) {
                    $.fancybox.open('#popin');
                    $.cookie(cookieId, 'true');
                }
            });
         })(jQuery);
    </script>


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</body>
</html>

